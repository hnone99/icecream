<!doctype html>
<html lang="ko"><head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Referrer" content="origin">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-title" content="HOMERUN_MARKET">
  <meta name="robots" content="index,nofollow">
  <meta name="description" content="HOMERUN_MARKET">
  <meta name="keywords" content="HOMERUN_MARKET">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>아이스크림 에코</title>
	<link rel="shortcut icon" href="https://xcdn.home-learn.com/eco/eco_icon_4qc_icon.ico">
  <link type="text/css" rel="stylesheet" href="https://market.home-learn.co.kr/webapp/css/bootstrap.css">
  <link type="text/css" rel="stylesheet" href="https://market.home-learn.co.kr/webapp/css/fonts/fontAwesomepro.css">
<!--   <script src="https://market.home-learn.co.kr/webapp/js/init.js"></script> -->
<link type="text/css" rel="stylesheet" href="https://market.home-learn.co.kr/webapp/css/style.css">
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<!-- 210727 css 추가 -->
<link type="text/css" rel="stylesheet" href="../css/style.css">
</head>

<body class="ui-new sub-page bg-white" style="" onselectstart="return false" ondragstart="return false">
<div class="wrap p-no">

  <div id="subnav"> <!-- ###ui-header-box -->
	  <header class="ui-header-box">
	    <div class="ui-header-box-wrap">
	      <!-- ##로고 -->
	      <h1 class="header-logo">
	        <a href="#">
	          <span class="img-logo">i-scream eco</span>
	        </a>
	        	<!-- #서브 타이틀 -->
	          <!-- js 서브 타이틀 태블릿 버전에만 사용 -->
	          <div class="h-title tablet" style="display:none">
	            <span class="txt">학습</span>
	            <span class="txt-mall">mall</span>
	          </div>
	          <!-- //#서브 타이틀 -->

	      </h1>
	      <!-- ##탭 -->
	      <nav class="header-tab">
	        <ul class="tab-list-grp noTablet" style="">&gt;
	          <!-- js 탭 활성화 on추가  -->
	          <li class="tab-list on" id="studysmall">
	            <span>학습<span class="txt-mall">mall</span></span>
	          </li>
	          <li class="tab-list" id="goodsmall">
	            <span>상품<span class="txt-mall">mall</span></span>
	          </li>
	        </ul>
	      </nav>
	      <!-- ##버튼 -->
	      <div class="header-btn" style="">
	        <button class="btn-top btn-loginout noTablet logout">로그아웃</button>
	        <button class="btn-top btn-joinus noTablet" style="display: none;">회원가입</button>
	        <button class="btn-top tablet" style="display:none">
	            <i class="ico i-top-back">나가기</i>
	        </button>
	      </div>
	    </div>
	  </header>
	  <!-- //###ui-header-box -->

	  <!-- 모바일 서브 상단 -->
	  <!-- ###ui-header-box-mo -->
	  <header class="ui-header-box-mo">
	    <h2 class="top-sub-title">결제</h2>
	    <button class="top-btn-prev">
	      <i class="ico i-top-btn-prev">이전</i>
	    </button>
	    <button class="top-btn-home">
	      <i class="ico i-top-btn-home">홈</i>
	    </button>
	  </header>
	  <!-- //###ui-header-box-mo -->

	  <!-- ###ui-sub-box -->
	  <div class="ui-sub-box">
	    <div class="ui-sub-box-wrap">
	      <!-- #이전 버튼 -->
	      <!-- js 이전 버튼 비활성화 off -->
	      <div class="sub-prev-area">
	        <button class="sub-btn-prev">
	          <i class="ico i-sub-btn-prev">이전</i>
	        </button>
	      </div>
	      <!-- ##서브 메뉴 -->
	      <div class="sub-menu-area">
	        <!-- 상세페이지 일 경우 타이틀 활성화 -->
	        <h2 class="top-sub-title">결제</h2>
	      </div>
	      <!-- ##서브 검색/마이페이지 -->
	      <div class="sub-util-area">
	        <button class="sub-btn-util _searchBtn">
	          <i class="ico i-top-search">검색</i>
	        </button>
	        <button class="sub-btn-util" style="font-family:revert">
	          <i class="ico i-top-member">마이페이지</i>
	        </button>
	      </div>


	  <!-- ##서브 검색창 영역 / 기존 소스 활용 -->
      <div class="search-box _searchBox">
        <div class="input-group">
          <!-- 검색 뒤로가기 -->
          <button class="btn-search-back">
            <i class="ico i-search-btn-back">검색 뒤로가기</i>
          </button>

          <input class="form-control _search" id="searchText" type="search" placeholder="검색어를 입력하세요" aria-label="Search">

          <a href="#" class="btn-search"><img src="../../img/common/btn-search-color-n@3x.png" alt=""></a>
          <a href="#" class="btn-search-close _searchClear" style="display: none;"><img src="../../img/common/btn-text-delete-n@3x.png" alt="" width="16" height="16"></a>
          <button class="sub-btn-util" id="menuList">
            <i class="ico i-top-menu">메뉴리스트</i>
          </button>
        </div>
        <div class="search-content">
          <div class="search-list"><p data-text="CU_0010_02">최근 검색어</p><div class="empty">	<div class="img"><img src="../../img/common/icon-120-clear-list@3x.png" alt="최근검색어가 없습니다."></div>	<p class="desc" data-text="CU_0010_03">최근 검색어가 없습니다.</p></div></div>
        </div>
      </div>



<!-- 		S:알람내용영역 -->
		<div tabindex="-1" id="divAlarm" class="drawer drawer-right" style="display:none">
<!-- 		<div tabindex="-1" id="divAlarm" class="drawer drawer-right drawer-open" style="outline: 0px;"> -->
			<div class="drawer-mask"></div>
			<!-- 210818 꼬리 엘리먼트 추가 -->
          <i class="i-drawer-tail"></i>
			<div class="drawer-content-wrapper">
				<div class="drawer-content">
					<div class="drawer-wrapper-body">

					<!-- #알림 최상단 -->
                	<!-- 알림 모바일만 적용 -->
					<section class="drawer-highest">
	                  <div class="top-left-area">
	                    <button class="top-btn top-btn-member noTablet">
	                      로그아웃
	                    </button>
	                    <!--[9월오픈 언어설정 빠짐] button class="top-btn top-btn-language" id="btnLang">
	                      언어설정
	                    </button> -->
	                  </div>
	                  <div class="top-right-area">
	                    <button class="top-btn-close">
	                      <i class="ico i-top-btn-close">닫기</i>
	                    </button>
	                  </div>
	                </section>
	                <!-- //#알림 최상단 -->

	               <!-- #알림 상단 -->
					<div class="drawer-header">
						<div class="drawer-title">
						   <span class="grade memberType"></span>
		                   <span class="study-access" id="small" style="display: none;"><a href="#">학습관 이용</a></span>
		                   <a href="/webapp/html/mypage/mypage.html" class="name"></a>
						</div>
					</div>

					<!-- //#알림 상단 -->
                	<!-- #알림 콘텐츠 -->
					<div class="drawer-body">
						<!-- 읽은 알림/읽지 않은 알림 -->
						<div class="alram">
							<span id="alarmCnt" style="display: none;">
	                   			<em>읽지 않은 알림이</em> <span class="text-secondary" data-text="CU_0004_17">개</span><em data-text="CU_0004_18">있습니다.</em>
	                   		</span>
<!-- 	                   		<a href="#" class="setting d-inline" data-toggle="modal" data-target="#tagNotice"><span class="text-secondary" data-text="CU_0004_07">알림설정</span></a> -->
		                   <span id="alarmNotCnt" style="display: none;">
		                   		<em data-text="CU_0004_16">읽지 않은 알림</em><em data-text="CU_0004_19">이 없습니다.</em>
		                   </span>
						</div>
						<hr class="line">
						<!-- 오늘 -->
                  		<div id="divAlarmBody">
						</div>
						 <!-- 알림이 비었습니다.
						 <div class="empty">
		                    <img src="../../img/common/icon-80-alram.png" alt="알람">
		                    <span data-text="CU_0004_22">알림함이 비었습니다.</span>
		                 </div>
						 //#알림 콘텐츠 -->
					</div>
           		   <!-- #알림 하단 -->
					<div class="drawer-footer">
<!-- 						<a href="#" class="btn-language" id="btnLang">언어설정</a> -->
               			<a href="#" id="logout" class="noTablet" data-text="CU_0004_04">로그아웃</a>
					</div>
					<!-- //#알림 하단 -->
				</div>
			</div>
		</div>
	</div>

	    </div>
	  </div>
	  <!-- //###ui-sub-box -->


<script type="text/javascript">
	$(document).ready(function() {

		//iphone 웹뷰 back 이벤트 일 경우
 	    $(window).bind("pageshow", function(event) {
			//iphone 웹뷰 back 이벤트 일 경우
		    if (Global.reqCommonData.devinfo == "MOBILE" && event.originalEvent && event.originalEvent.persisted) {
    	    	window.location.reload();
	    	}
		});

// 		includeCommonSearch();
		//공통 이전 처리
		$(".sub-btn-prev, .i-sub-btn-prev, .top-btn-prev").on('click', function (e) {
			onClickEventPrevent(e);
			var path = "/webapp/html";

			var location = window.location.pathname ? window.location.pathname : "" ;
			location = location.replace(path, "");


			//backpress 화면 세팅
			var spc = sessionStorage.spc;
			var ordrIdx = sessionStorage.ordrIdx;
			var uci = sessionStorage.upCategoryId;
			var ci = sessionStorage.categoryId;
			var tag = sessionStorage.tag;

			sessionStorage.removeItem('spc');
			sessionStorage.removeItem('ordrIdx');
			sessionStorage.removeItem('upCategoryId');
			sessionStorage.removeItem('categoryId');
			sessionStorage.removeItem('tag');

			if(location.startsWith("/mypage")){
				if(location.indexOf("paydate.html") != -1){
					window.location.href = path + "/mypage/manage.html";
				}else if(location.indexOf("mypage.html") != -1){
					window.location.href = path + "/main/main.html";
				}else{
					window.location.href = path + "/mypage/mypage.html";
				}
			}else if(location.startsWith("/brand") || location.startsWith("/curriculumMain") || location.startsWith("/event")){
				if(!$.isEmpty($.getUrlParam("upCategoryId"))){
					window.location.href = path + "/curriculumMain/curriculumMain.html?upCategoryId="+$.getUrlParam("upCategoryId");
				}else{
					window.location.href = path + "/main/main.html";
				}
			}else if(location.startsWith("/login")){
				window.location.href = path + "/main/main.html";
			}else if(location.startsWith("/product")){
				/*
				if(location.indexOf("payInfo.html") != -1){
					if(!$.isEmpty($.getUrlParam("saleProductCode"))){
						window.location.href = path + "/product/detail.html?saleProductCode="+$.getUrlParam("saleProductCode");
					}else {
						window.location.href = path + "/main/main.html";
					}

				}else{
					window.location.href = path + "/main/main.html";
				}
				*/

				if(location.indexOf("payInfo.html") != -1){
					if(!$.isEmpty($.getUrlParam("saleProductCode"))){
						window.location.href = path + "/product/detail.html?saleProductCode="+$.getUrlParam("saleProductCode");
					}else {
						window.location.href = path + "/main/main.html";
					}

				}else{
					//detail.html
						history.back();
// 					if(!$.isEmpty(ci) || !$.isEmpty(tag)){
// 					}else{
// 						if($.isEmpty(uci)){
// 							window.location.href = path + "/main/main.html";
// 						}else{
// 							window.location.href = path + "/curriculumMain/curriculumMain.html?upCategoryId="+uci;
// 						}
// 					}
				}
			}else{
				if(location.indexOf('kcp') != -1 ||  location.indexOf('batch') != -1
					 	|| (location.indexOf('payment') != -1 && location.startsWith('/mypage/payment.html') == -1 )  ){
					//결제 중 에러//
					if(spc != null && spc != ""){
						if(ordrIdx != null){
							//결제 중 에러
							goBack(ordrIdx, spc);
						}else{
							//결제는 아직
							location.replace(path + "/product/detail.html?saleProductCode="+spc);
						}
					}else{
						history.back();
					}
				}else{
					history.back();
				}
				//history.back();
			}
		});

		/*  if(isApp()){
			 //하이브리드인 경우 tablet mode 세팅
			 $(".tablet").css("display","");
	    	 $(".btn-loginout").css("display","none");
	    	 $(".btn-joinus").css("display","none");
		 }
 */

		//상품몰 이동
		$('#goodsmall').on('click', function() {
		    location.href = oLink[oLink.env].goodsMall;
		 });
		//학습몰 이동
		$('#studysmall').on('click', function() {
		    location.href =  "/webapp/html/main/main.html";
		 });

		//공통 이전
		/*$(".sub-btn-prev, .top-btn-prev").on('click', function(e) {
			onClickEventPrevent(e);
			history.back();
		});*/
		//공통 홈
		$(".i-top-btn-home").on('click', function(e) {
			onClickEventPrevent(e);
			location.href = "/webapp/html/main/main.html";
		});
		//검색닫기버튼(모바일)
		$(".btn-search-back").on('click', function(e) {
			onClickEventPrevent(e);
			$('._searchBox').css('display','none');
			$('._searchBox').removeClass('show');
		});

		//검색지우기버튼(모바일)
		$("._searchClear").on('click', function(e) {
			onClickEventPrevent(e);
			$('#searchText').val("");
		});

		//회원가입: 아이스크림 홈페이지
		$(".btn-joinus").on('click', function(e) {
			onClickEventPrevent(e);
		    location.href = oLink[oLink.env].eduJoin;
// 		    var url = "https://dev-nhome.home-learn.com/integrate/interJoin.do?inflow_cd=10003";
// 		    openNewBrowser(url);
		});

	 	//로그인
		$(".btn-loginout, .top-btn-member").on('click', function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
			if($(".btn-loginout").hasClass("logout")){
				//로그아웃 --> 내 정보 (마이페이지로 이동)
// 				location.href = "/webapp/html/mypage/mypage.html";
				$("#logout").trigger('click');
			}else{
				//로그인
				location.href = "/webapp/html/login/login.html";

			}
		});


		//회원가입: 아이스크림 홈페이지
		$(".btn-joinus").on('click', function(e) {
			onClickEventPrevent(e);
		    location.href = oLink[oLink.env].eduJoin;
// 		    var url = "https://dev-nhome.home-learn.com/integrate/interJoin.do?inflow_cd=10003";
// 		    openNewBrowser(url);
		});


		//언어설정 창
		/*
		if(localStorage.getItem("isFirst") != 'N'){
			var oldLang = Global.reqCommonData.countryCode;
			openModalPopup("langSettingPopup","/webapp/html/common/popup/language.html",
				"common-lang-setting", null, function(data) {
					if (Global.reqCommonData.countryCode != oldLang) {
						fnSetLangImg();
						window.location.reload();
					}
				});

			localStorage.setItem("isFirst","N");
		}
		$('#btnSearch').on('click', function (e) {
			onClickEventPrevent(e);
		});
		*/


		$(document).click(function(e){ //문서 body를 클릭했을때
// 			console.log('target: '+ e.target.className);
// 			console.log('.i-top-member").hasClass show >>'+ $('.i-top-member').hasClass('show'));
	 		if($('.i-top-member').hasClass('show') && e.target.className !="drawer-content-wrapper" && e.target.className !="daylist"){
		 		//알람 숨김
// 		 		console.log('들어옴 ');
		 		$('.i-top-member').removeClass('hasalram');
		 		$('.i-top-member').removeClass('show');
				$('#divAlarm').removeClass('drawer-open');
		 		$('#divAlarm').css('display','none');
	 		}else if(!$('.i-top-member').hasClass('show') && e.target.className == "ico i-top-member"){
	 			$('.i-top-member').trigger('click');
		 		$('#divAlarm').css('display','block');
// 	 			$('.i-top-member').removeClass('hasalram');
// 		 		$('.i-top-member').addClass('show');
// 				$('#divAlarm').addClass('drawer-open');
	 		}
	 		//푸터 패밀리사이트 닫기
			if(e.target.className != "familySite open"){
				$('#familySite').blur();
				$("#familySite").removeClass("open");
			}


// 	 		console.log('._searchBox").hasClass show >>'+ $("._searchBox").hasClass('show'));
	 		if( $("._searchBox").hasClass('show')  && e.target.className !="" && e.target.className !="ico i-top-search" && e.target.className != "form-control _search" && e.target.className != "search-content"){
	 			//검색창 숨김
// 	 			console.log('들어옴2 ');
		 		$('._searchBox').css('display','none');
		 		$('._searchBox').removeClass('show');

	 		}else if(!$('._searchBox').hasClass('show') && e.target.className == "ico i-top-search"){
// 	 			$('.i-top-member').removeClass('hasalram');
	 			$('._searchBox').css('display','block');
		 		$('._searchBox').addClass('show');
	 		}
		 });

		//알람 숨김
		$(".setting.text-secondary").click(function(e){
			$('.i-top-member').removeClass('show').removeClass('hasalram');
			$('#divAlarm').removeClass('drawer-open');
			$('#divAlarm').css('display','none');
		 });
		//이름영역 >
		 $('.drawer-title').click(function(e){
		 	location.href = "/webapp/html/mypage/mypage.html";
		 });

		//검색 열기
		$("._searchBtn, .btn-search").click(function(e){
// 			console.log("._searchBox-------");
			$('.i-top-member').removeClass('show').removeClass('hasalram');
			$('#divAlarm').removeClass('drawer-open');
			$('#divAlarm').css('display','none');
			$('#divAlarm').removeClass('show');

			$('._searchBox').css('display','block');
			$('._searchBox').addClass('show');

// 			console.log($('#searchText').val());
// 			if(!$.isEmpty($('#searchText').val())){
// 				location.href = '/webapp/html/common/result.html?searchValue='+$('#searchText').val();
// 			}

		 });

		$(".top-btn-close, .i-top-btn-close").click(function(e){
			$('.i-top-member').removeClass('show').removeClass('hasalram');
			$('#divAlarm').removeClass('drawer-open');
			$('#divAlarm').css('display','none');
		 });

		$("#btnLang").click(function(e){
			$('.i-top-member').removeClass('show').removeClass('hasalram');
			$('#divAlarm').removeClass('drawer-open');
			$('#divAlarm').css('display','none');
		 });

		hideLoadingbar();

		//login 안했을때
		//$('.hasalram').hide();
// 		includeCommonSearch();


		//[9월오픈] 언어설정 안보임
		//pc환경일 경우 언어표시 show, eco 이동 숨김
		if (!isApp()) { // && !isHybrid()
			$(".tab-list-grp").css("display","");
			$(".noTablet").css("display","");
			$(".tablet").css("display","none");
			/*
			fnSetLangImg();
			$("#btnLang").show();
			$(".navbar-btn-eco").hide();
			$(".navbar-util").css('right', '32px');
			if(localStorage.getItem("isFirst") != 'N'){
				var oldLang = Global.reqCommonData.countryCode;
				openModalPopup("langSettingPopup","/webapp/html/common/popup/language.html", "common-lang-setting", null, function(data) {
					if (Global.reqCommonData.countryCode != oldLang) {
						fnSetLangImg();
						window.location.reload();
					}
				});

				localStorage.setItem("isFirst","N");
			}
			*/
		} else {

			//학습기ㅣ 진입시에만
			$(".tab-list-grp").css("display","none");
			$(".noTablet").css("display","none");

		    $(".tablet").css("display","");
// 			 if(localStorage.getItem('IS_HYBRID') =='Y'){//isHybrid()){
// 				 //하이브리드인 경우 tablet mode 세팅
// 				//학습몰/상품몰 텝 안보임
// 			 }else{
// 					$(".tab-list-grp").css("display","");
// 					$(".noTablet").css("display","");
// 					$(".tablet").css("display","none");
// 			}

// 			if (isEcoDevice()) {
// 				$("#logout").hide();
// 				$(".btn-loginout").hide();

// 				$(".btn-loginout").css('display','none');
// 				$(".btn-joinus").css('display','none');
// 			}
		}
		var data = Global.getReqCommonData();



		//로그인 사용자인경우
		if (!$.isEmpty(getCookie("loginSid"))) {
			//알림 건수만 조회
			$.postJSON('/marketplace/common/productAlarm', {searchType : "0"}, fnSetNavHasAlarm, false);
			$("#login-off").hide();
			$(".i-top-member").show();

			$(".btn-loginout").text(commonMessage('CU_0004_04'));	//로그아웃-> 내 정보로 변경
// 			$(".btn-loginout").text("내 정보");
			$(".btn-loginout").addClass('logout');
			$(".btn-joinus").css('display','none');

			//학생일떈 탭 가리기
// 			if(sessionStorage.getItem('loginType') == "" || sessionStorage.getItem('loginType') == null ){
			if(getCookie('loginType') == "" || getCookie('loginType') ==  null){
				$(".tab-list-grp").css("display","none");
			}

		}else{
			//로그인 사용자가 아닌 경우 표시
			$(".btn-loginout").text(commonMessage('LI_0001_05')); //로그인
			$(".btn-loginout").removeClass('logout');
			$(".btn-joinus").css('display','');
		}
		//세팅 후 보이기
		$('.header-btn').css('display','');




		$("#btnNavLogo, #login-off").on('click', function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
							//		var location = window.location.pathname ? window.location.pathname : "" ;
							//		location = location.replace("/webapp/html", "");
							//		//로그인 정보 찾기 화면에서 로그인시 메인으로 이동
							//		if(location.startsWith("/login/findInfo.html")){
							//			window.location.href = $(this).attr("href")+"?before=N";
							//		}else{
							//			window.location.href = $(this).attr("href")+"?before=Y";
							//		}
			location.href = $(this).attr("href");
		});

		$(".navbar-btn-eco a").on('click', function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
			if(isApp()){
				goEcoApp();
			}else if(isHybrid()){
				closeWebView();
			}
		});

		//메인 로고
		$(".top-btn-home, .img-logo, .header-logo, .img-logo, .header-logo, .top-btn-home").on('click', function(e) {
			onClickEventPrevent(e);
			location.href = "/webapp/html/main/main.html";
		});

		//프로필 클릭
		$('.i-top-member, .i-top-menu').on('click',function(e) {
// 			console.log('click my box')
			onClickEventPrevent(e);
			e.stopPropagation();

			//로그인 된 회원이라면
			if (!$.isEmpty(getCookie("loginSid"))) {
				//i-top-member, .i-top-menu
				if($(this).hasClass('i-top-member')){
					if ($(".i-top-member").hasClass('show')) {
						//알림 숨김
						$(this).removeClass('show').removeClass('hasalram');
						$('#divAlarm').removeClass('drawer-open');
						$('#divAlarm').css('display','none');
					} else {
						//알림 보임
						$.postJSON('/marketplace/common/productAlarm', {searchType : "1"}, fnSetNavProductAlarm, false);
						$(this).addClass('show');
						$('#divAlarm').css('display','');
					}
				}else{
					$.postJSON('/marketplace/common/productAlarm', {searchType : "1"}, fnSetNavProductAlarm, false);
// 									$(this).addClass('show');
				}

			}else{

				//로그인 화면으로 이동
				history.pushState(null, '' , '/webapp/html/main/main.html');
				location.replace("/webapp/html/login/login.html");
			}
		});

						//프로필 클릭
/*						$('.sl-menu').on('click',function(e) {

							console.log('모바일 햄버거');
							onClickEventPrevent(e);
							e.stopPropagation();
							//로그인 된 회원이라면
							if (!$.isEmpty(Global.reqCommonData.memberSid)) {
								//알림 보임
								$.postJSON('/marketplace/common/productAlarm', {searchType : "1"}, fnSetNavProductAlarm, false);
								$('#divAlarm').addClass('drawer-open');

							}else{
								//로그인 화면으로 이동
								history.pushState(null, '' , '/webapp/html/main/main.html');
								location.replace("/webapp/html/login/login.html");
							}
						});
*/

		$.getScript(snsLoginConfig[snsLoginConfig.env].kakao.url, function(){
			Kakao.init(snsLoginConfig[snsLoginConfig.env].kakao.key);
// 			console.log('init-->' + getCookie("kakao"))
		});

		//로그아웃
/*		$("#logout").on('click',function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();

			if (!$.isEmpty(getCookie("kakao"))) {
// 				alert('1-->' + getCookie("kakao"))
				Kakao.Auth.setAccessToken(getCookie("kakao"));
// 				alert('1-1->' + Kakao.Auth.getAccessToken());

				Kakao.Auth.logout(function() {
// 					alert('2-->' );

					$.postJSON('/marketplace/login/logout',	{}, function(resData) {
						var isSavedYn = localStorage.getItem('isSavedYn');
						var loginId = sessionStorage.getItem('loginId');
						var nowLang = sessionStorage.getItem('lang');

						//프로필 열려있다면 닫고
						if($('.i-top-member').hasClass('show')){
					 		$('.i-top-member').removeClass('hasalram');
					 		$('.i-top-member').removeClass('show');
							$('#divAlarm').removeClass('drawer-open');
					 		$('#divAlarm').css('display','none');
						}

						//프로필 지우기
						//아무것도 없도록 세팅
						$('.drawer-content .memberType').text('');
						$('.drawer-content .name').text('');
						var template = '';
						template += '<div class="empty">';
						template += '	<img src="../../img/common/icon-80-alram.png" alt="알람">';
						template += '	<span data-text="CU_0004_22">'
								+ commonMessage("CU_0004_22") + '</span>';
						template += '</div>';
						$("#divAlarmBody").html(template);
						//아무것도 없도록 세팅

						sessionStorage.clear();
						clearMarketCookie();

						if (isSavedYn == "Y") {
							localStorage.setItem('isSavedYn',isSavedYn);
							sessionStorage.setItem('loginId',loginId);
						}
						//언어는 유지
						sessionStorage.setItem('lang',nowLang);
						history.pushState(null, '' , '/webapp/html/main/main.html');
//		 				history.replaceState(null, '' , '/webapp/html/main/main.html');
//		 				location.replace("/webapp/html/login/login.html");

						window.location.href = "/webapp/html/login/login.html";
						}, false);
				});
			}else{


				$.postJSON('/marketplace/login/logout',	{}, function(resData) {
					var isSavedYn = localStorage.getItem('isSavedYn');
					var loginId = sessionStorage.getItem('loginId');
					var nowLang = sessionStorage.getItem('lang');

					//프로필 열려있다면 닫고
					if($('.i-top-member').hasClass('show')){
				 		$('.i-top-member').removeClass('hasalram');
				 		$('.i-top-member').removeClass('show');
						$('#divAlarm').removeClass('drawer-open');
				 		$('#divAlarm').css('display','none');
					}

					//프로필 지우기
					//아무것도 없도록 세팅
					$('.drawer-content .memberType').text('');
					$('.drawer-content .name').text('');
					var template = '';
					template += '<div class="empty">';
					template += '	<img src="../../img/common/icon-80-alram.png" alt="알람">';
					template += '	<span data-text="CU_0004_22">'
							+ commonMessage("CU_0004_22") + '</span>';
					template += '</div>';
					$("#divAlarmBody").html(template);
					//아무것도 없도록 세팅

					sessionStorage.clear();
					clearMarketCookie();

					if (isSavedYn == "Y") {
						localStorage.setItem('isSavedYn',isSavedYn);
						sessionStorage.setItem('loginId',loginId);
					}
					//언어는 유지
					sessionStorage.setItem('lang',nowLang);
					history.pushState(null, '' , '/webapp/html/main/main.html');
//	 				history.replaceState(null, '' , '/webapp/html/main/main.html');
//	 				location.replace("/webapp/html/login/login.html");

					window.location.href = "/webapp/html/login/login.html";
					}, false);
			}


		});
*/
		$(".drawer-mask").on('click', function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
			$('.i-top-member').click();
		});

		//알림설정 클릭
		$("#divAlarm .setting").on('click', function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
			openModalPopup("tagAlarmPopup", "/webapp/html/common/popup/tagAlarm.html", "tag-notice-setting");
		});

		//언어 클릭
		$("#btnLang").on('click',function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
			var oldLang = Global.reqCommonData.countryCode;
			openModalPopup("langSettingPopup","/webapp/html/common/popup/language.html", "common-lang-setting", null, function(data) {
				if (Global.reqCommonData.countryCode != oldLang) {
					fnSetLangImg();
					window.location.reload();
				}
			});
		});

		//마켓웹뷰 닫기
		$(".i-top-back").on('click',function(e) {
			//쿠키 삭제
			 $("#logout").trigger('click');
			 closeWebView();
		});

		//메뉴클릭
		$("li.nav-item a").on('click', function(e) {
			onClickEventPrevent(e);
			e.stopPropagation();
			showLoadingbar();
			var upCategoryId = $(this).data("upcategoryid");
			if ($.isEmpty(upCategoryId)) {
				location.replace($(this).attr("href"));
			} else {
				location.replace($(this).attr("href")+ "?upCategoryId="+ upCategoryId);
			}
		});

		//언어 이미지 설정
		function fnSetLangImg() {
			var language = nvl( Global.getReqCommonData().countryCode, "ko");
			$("#btnLang img[data-language!=" + language + "]").hide();
			$("#btnLang img[data-language=" + language + "]").show();
		}



		var $inputSearch = $("._search");
	    var $inputClear = $('._searchClear');

		var searchTgt = $(".search-box .search-list");
		var recentList = sessionStorage.getItem('eco_recent_search_list');

		if($.isEmpty(recentList)){
			recentList = new Array();
		}else{
			recentList = JSON.parse(recentList);
			recentList.sort(function(a,b){
				return new Date(b.date) - new Date(a.date);
			});
		}

		//최근검색어 표출
		fnSetRecentSearchValue();
		//검색어 초기화
		$inputClear.toggle(Boolean($inputSearch.val()));

		//검색어 초기화
		$inputClear.on('click', function () {
			$inputSearch.val('').focus();
			$(this).hide();
			fnSetRecentSearchValue();
		});

		//검색어 자동 완성
		$inputSearch.on("keyup", function(e){
			$inputClear.toggle(Boolean($(this).val()));

			 //평가글
		    $('#searchText').keyup(function(){
		    	//500자 제한
		    	if($('#searchText').val().length > 50) {
					$('#searchText').val($('#searchText').val().substring(0, 50));
				}
			});



			if (e.keyCode == 13) {
				 fnEcoMarketSearch();
				 return;
	       	}

			var searchValue = $(this).val();

			if($.isEmpty(searchValue)){
				//최근검색어 표출
				fnSetRecentSearchValue();
			}else{
				$.postJSON('/marketplace/common/presearch'
						, {searchValue : searchValue}
						, function(data){
								searchTgt.addClass("_searchList");
								searchTgt.html("<ul></ul>");

								if(!$.isEmpty(data) && !$.isEmpty(data.list)){
									$.each(data.list, function(index, item){
										if(index == 20){
											return;
										}

										var matchArray = nvl(item).match(new RegExp(searchValue, "gi"));
										var value = nvl(item);

										$.each(matchArray, function(matchIndex, matchItem){
											value = value.replace(matchItem, '<span class="highlight">'+matchItem+'</span>');
										});

										var template = '';
										template += '<li>';
										template += '	<a class="item-1" href="#" data-searchvalue="'+nvl(item)+'">';
										template += '		<span class="img"><img src="../../img/common/icon-24-search-auto@3x.png" alt="관련검색어"></span>';
										template += '		<span class="text" style="word-break:break-all;">'+value+'</span>';
										template += '	</a>';
										template += '	<div class="item-2">';
										template += '		<a href="#" data-searchvalue="'+nvl(item)+'"><img src="../../img/common/history-button-n@3x.png" alt="" width="20" height="20"></a>';
										template += '	</div>';
										template += '</li>';

										searchTgt.find("ul").append(template);
										searchTgt.find("ul li:last a").each(function(eventIndex, eventItem){
											eventItem.addEventListener("click", fnSetSearchValue);
										});

									});

									$("._searchList").parent().show();
								}else{
									$("._searchList").parent().hide();
								}
						  }
						, false);
			}

		});

		//검색 돋보기 클릭
		$(".search-box .btn-search").on("click", function(e){
			onClickEventPrevent(e);
			fnEcoMarketSearch();
		});

	//마켓 플레이스 검색
	function fnEcoMarketSearch(){
		var searchValue = $inputSearch.val();

		if(!$.isEmpty(searchValue)){
			if(!$.isEmpty(recentList)){
				var index = -1;
				$.each(recentList, function(i, obj){
					if(obj.searchValue == searchValue){
						index = i;
						return;
					}
				});

// 				var index = recentList.findIndex(function(obj){ return obj.searchValue == searchValue; });
				if(index > -1){
					recentList.splice(index, 1);
				}
			}

			recentList.push({date: new Date(), searchValue : searchValue});
			recentList.sort(function(a,b){
				return new Date(b.date) - new Date(a.date);
			});
			sessionStorage.setItem('eco_recent_search_list', JSON.stringify(recentList));
		}

		var loc = window.location.pathname ? window.location.pathname : "" ;

		if(loc.indexOf("/common/result.html") != -1){
			location.replace("/webapp/html/common/result.html?searchValue="+encodeURI(searchValue));
		}else{
			window.location.href="/webapp/html/common/result.html?searchValue="+encodeURI(searchValue);
		}
	}

	//최근 검색어
	function fnSetRecentSearchValue(){

		searchTgt.removeClass("_searchList");

		if($.isEmpty(recentList)){
			var template = '';
			template += '<p data-text="CU_0010_02">'+commonMessage("CU_0010_02")+'</p>';
			template += '<div class="empty">';
			template += '	<div class="img"><img src="../../img/common/icon-120-clear-list@3x.png" alt="최근검색어가 없습니다."></div>';
			template += '	<p class="desc" data-text="CU_0010_03">'+commonMessage("CU_0010_03")+'</p>';
			template += '</div>';
			searchTgt.html(template);
		}else{

			var template = '';
			template += '<p data-text="CU_0010_02">'+commonMessage("CU_0010_02")+'</p>';
			template += '<ul></ul>';
			searchTgt.html(template);

			$.each(recentList, function(index, item){

				//최대 20개 제공
				if(index >= 20){
					return false;
				}

				template = '';
				template += '<li>';
				template += '	<a class="item-1" href="#" data-searchvalue="'+nvl(item.searchValue)+'">';
				template += '		<span class="img"><img src="../../img/common/icon-24-search-recent@3x.png" alt="최신검색어"></span>';
				template += '		<span class="text" style="word-break:break-all;">'+nvl(item.searchValue)+'</span>';
				template += '	</a>';
				template += '	<div class="item-2">';
				template += '		<span class="date">'+new Date(item.date).format("MM.dd")+'</span>';
				template += '		<a href="#" data-index="'+index+'"><img src="../../img/common/btn-delete-n@3x.png" alt="" width="20" height="20" alt="최신검색어삭제"></a>';
				template += '	</div>';
				template += '</li>';

				searchTgt.find("ul").append(template);
				if(searchTgt.find("ul li:last a.item-1").length > 0) {
					searchTgt.find("ul li:last a.item-1")[0].addEventListener("click", fnSetSearchValue);
				}

				if(searchTgt.find("ul li:last div.item-2 a").length > 0) {
					searchTgt.find("ul li:last div.item-2 a")[0].addEventListener("click", fnDeleteSearchValue);
				}
			});
		}
	}

	//검색어 셋팅
	function fnSetSearchValue(e){
		onClickEventPrevent(e);
		$inputSearch.val($(this).data("searchvalue"));
		fnEcoMarketSearch();
	}

	//검색어 삭제
	function fnDeleteSearchValue(e){
		onClickEventPrevent(e);

		if(!$.isEmpty(recentList)){
			var index = $(this).data("index");
			recentList.splice(index, 1);
			sessionStorage.setItem('eco_recent_search_list', JSON.stringify(recentList));
		}

		fnSetRecentSearchValue();
	}
});


	//읽지않은 알림 셋팅
	var fnSetNavHasAlarm = function(resData) {

		if (!$.isEmpty(resData) && !$.isEmpty(resData.notReadCnt) && resData.notReadCnt > 0) {
			$(".i-top-member").addClass("hasalram");
		}

		//로그인 사용자인경우
		if (!$.isEmpty(Global.reqCommonData.memberSid)) {
			$("#login-off").hide();
			$(".i-top-member").show();
		}
	}

	//상품 알림 목록 셋팅
	var fnSetNavProductAlarm = function(resData) {

		if (!$.isEmpty(resData)) {

			var memberType = Global.reqCommonData.memberType;
			//학부모
			if (getCookie('loginType') == "0" || getCookie('loginType') == "2") {
				$("#divAlarm .memberType").text(commonMessage("CU_0004_12"));

				if (getCookie('loginType') == '2') {
					$("#small").show();
				}

			} else if (getCookie('loginType') == "1") {
				$("#divAlarm .memberType").text(commonMessage("CU_0004_14"));
			} else if ($.isEmpty(getCookie('loginType'))) {
				//학생
				if(sessionStorage.getItem('buyer') == 1 || getCookie('buyer')  == 1 ){
					$("#divAlarm .memberType").text(commonMessage("CU_0004_23"));
				}else{
					$("#divAlarm .memberType").text(commonMessage("CU_0004_13"));
				}
			}
// 			console.log('name:'+Global.reqCommonData.memberName);
// 			$("#divAlarm .name").text(nvl(Global.reqCommonData.memberName));
// 			$("#divAlarm .name").text(nvl(sessionStorage.getItem('loginName')));
			$("#divAlarm .name").text(nvl(decodeURIComponent(getCookie('loginName'))));

			var notReadCnt = resData.notReadCnt;
			if (notReadCnt > 0) {
				if (notReadCnt >= 1000) {
					notReadCnt = "999+";
				}

				$(".i-top-member").addClass("hasalram");
				$("#alarmCnt").find("span").text(commonMessage("CU_0004_17", notReadCnt));
				$("#alarmCnt").show();
				$("#alarmNotCnt").hide();
			} else {
				$(".i-top-member").removeClass("hasalram");
				$("#alarmCnt").hide();
				$("#alarmNotCnt").show();
			}

			if (!$.isEmpty(resData.list)) {

				var template = '';
				template += '<div class="daylist">';

				$.each(
								resData.list,
								function(index, item) {
									var beforeDate = index == 0 ? ""
											: resData.list[index - 1].alarmDate;
									var nextDate = index == resData.list.length - 1 ? ""
											: resData.list[index + 1].alarmDate;

									if (beforeDate != item.alarmDate) {
										template += '<div class="date">'
												+ item.alarmDate + '</div>';
										template += '<ul>';
									}

									template += '<li>';
									template += '	<span class="desc">';
									template += '		<span class="text-secondary">'
											+ nvl(item.alarmTitle) + '</span>';

									if (item.alarmType == "0") {
										//에 새로운 학습이 등록되었습니다.
										template += '<em data-text="CU_0004_21">'
												+ commonMessage("CU_0004_21")
												+ '</em>';
									} else if (item.alarmType == "1") {
										//님이 공부하고 싶은 학습을 요청했습니다.
										template += '<em data-text="CU_0004_10">'
												+ commonMessage("CU_0004_10",
														"") + '</em>';
									} else if (item.alarmType == "2") {
										//학습을 시작하세요.
										template += '<em data-text="CU_0004_11">'
												+ commonMessage("CU_0004_11")
												+ '</em>';
									}

									template += '	</span>';
									template += '	<span class="list" style="cursor: pointer;" onClick="goProducctDetailPage(\''
											+ item.saleProductCode + '\')">';
									template += '		<img src="'+item.icon+'" alt="'+item.productName+'" style="width:66px;" >';
									template += '		<em>' + item.productName
											+ '</em>';

									if (item.readYn == "N") {
										template += '	<i class="new"><img src="../../img/common/icon-list-badge-new@3x.png" alt="읽지않은 알림" width="16"></i>';
									}

									template += '	</span>';
									template += '</li>';

									if (nextDate != item.alarmDate) {
										template += '</ul>';
									}
								});

				template += '</div>';
				$("#divAlarmBody").html(template);
			} else {
				var template = '';
				template += '<div class="empty">';
				template += '	<img src="../../img/common/icon-80-alram.png" alt="알람">';
				template += '	<span data-text="CU_0004_22">'
						+ commonMessage("CU_0004_22") + '</span>';
				template += '</div>';
				$("#divAlarmBody").html(template);
			}
		}

		$('#divAlarm').addClass('drawer-open');
	}
</script>
</div>


  <!-- 상세페이지 일 경우 감싸는 엘리먼트 추가 -->
  <!-- ###ui-detail-box -->
  <div class="ui-detail-box">
    <div class="ui-detail-box-wrap">

     <div class="container-lg container-fluid px-rem-xl-3 px-rem-0">
        <!-- px-rem-xl-3로 변경 -- 2020.09.24  -->

	    <!-- S contents -->
	    <div class="payment">

	      <!-- 결제 상단 부분 -->
	      <div class="p-product">
	        <div class="info">
	          <div class="app-icon">
	            <img id="mainIcon" src="https://xcdn.home-learn.com/eco//saleProduct/20211101201933/main thumnail.png" width="80" alt="">
	          </div>
	          <div class="title" id="title">[12개월]리딩앤-초등 교과 패키지</div>
	          <div class="company text-ellipsis" id="brandName">주식회사 아이포트폴리오</div>
	          <div class="star">
	            <img src="../../img/common/icon-16-star@2x.png" alt="">
	            <span id="star">5.0</span>
	          </div>
	        </div>
	      </div>

	      <!-- 결제 정보 -->
	      <div class="p-info">
	        <div class="accordion" id="paymentAccordion">
	          <!-- 학습할 자녀 -->
	          <div class="card">
	            <div class="card-header" id="headingFirstMenu" data-toggle="collapse" data-target="#collapseFirstMenu" aria-expanded="true" aria-controls="collapseFirstMenu">
	             <!-- 학부모: 학습할 자녀 -->
	              <!-- 선생님: 수량 -->
	              <div class="title-area">
	                <span class="title text-ellipsis" id="title1_1" data-text="AD_0023_01">학습할 자녀</span>
	                <span class="title text-ellipsis" id="title1_2" data-text="AD_0026_01" style="display:none">수량</span>
	                <a href="#" class="btn-accordion" id="accordian1"><span class="img"></span></a>
	              </div>

	              <div class="t-selected">
	                <span class="highlight" id="selectStudent">김나리</span><!-- 학부모:김홈런/ 선생님:2개 --><!-- data-text="AD_0025_05" -->
																	 <!--  학부모 다계정 : 김홈런 외 1명 -->
	              </div>
	            </div>
	            <div id="collapseFirstMenu" class="collapse show" aria-labelledby="headingFirstMenu" data-parent="#paymentAccordion">

	              <!-- 학부모 -->
	              <div class="card-body" id="studentInfo" style="display: block;">
	              	<p class="text-top infoText" data-text="AD_0025_06" style="display:none">학습관 이용 자녀만 학습이 가능합니다.</p>
	                <ul class="user-list" id="studentList">
                    <li>
                      <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" id="children1" name="name" class="custom-control-input line" checked="">
                        <label class="custom-control-label" for="children1" >김홈런<span class="desc">(kim_homelearning/초3)</span></label>
                      </div>
                    </li>
	                  <li>
                      <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" name="name" id="children0" class="custom-control-input line" checked="" data-selectname="김홈런" data-selectid="1067082"> <label class="custom-control-label" for="children0">
                          김홈런<span class="desc">(home2323/초6)</span>

                          <!-- 211203 결재 문구 추가 -->
                          <span class="t-info-highlight">
                            스마트러닝 학생은 이용이 불가능합니다.
                          </span>

                        </label>
                      </div>
                    </li>
                    <li>
                      <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" name="name" id="children0" class="custom-control-input line" checked="" data-selectname="김홈런" data-selectid="1067082" disabled> <label class="custom-control-label" for="children0">
                          김홈런<span class="desc">(home2323/초6)</span>

                          <!-- 211203 결재 문구 추가 -->
                          <span class="t-info-highlight">
                            스마트러닝 학생은 이용이 불가능합니다.스마트러닝 학생은 이용이 불가능합니다.스마트러닝 학생은 이용이 불가능합니다.스마트러닝 학생은 이용이 불가능합니다.
                          </span>

                        </label>
                      </div>
                    </li>
                  </ul>
	                <div class="btn-wrap">
	                  <a href="#" class="btn btn-round next1" id="next11" data-text="AD_0023_02">다음</a>
	                </div>
	              </div>

	              <!-- 학부모 다계정 -->
	              <div class="card-body" id="studentBroInfo" style="display: none;">
	                <div class="top-list" id="selectAll">
	                  <span class="left" data-text="AD_0025_01" data-selected="all" id="selectAllText">전체 선택</span>
	                  <span class="right" id="selectText"></span>
	                </div>
	                <p class="text-top infoText" data-text="AD_0025_06" style="display:none">학습관 이용 자녀만 학습이 가능합니다.</p>
	                <ul class="user-list" id="studentBroList">
	                <!--   <li>
	                    <div class="custom-control custom-checkbox custom-control-inline">
	                      <input type="checkbox" class="custom-control-input" id="children1" checked="" name="studentBro">
	                      <label class="custom-control-label" for="children1">김홈런
	                       <span class="badge-list" data-text="CU_0023_02">학습중</span>
	                      <span class="desc">(kim_homelearning/초3)</span></label>
	                    </div>
	                  </li> -->
	                </ul>
	                <div class="btn-wrap">
	                  <a href="#" class="btn btn-round next1" data-text="AD_0023_02" id="next12">다음</a>
	                </div>
	              </div>


	              <!-- 선생님 -->
	              <div class="card-body" id="monthInfo" style="display:none">
	                <div class="qty-wrap clearfix">
	                  <div class="qty-info">
	                    <span class="title" data-text="CU_0028_01" id="payOptionName"></span>
	                    <span class="value" id="monthPrice"><em class="font-weight-bold">￦</em> / <em data-text="CU_0029_07">월</em></span>
	                  </div>
	                  <div class="count-num">
	                    <a class="qty-minus" href="#"><img src="../../img/common/btn-minus-n@3x.png" alt="" width="16"></a>
	                    <input type="number" class="qty" id="qty" title="qty" value="1" min="0">
	                    <a class="qty-plus" href="#"><img src="../../img/common/btn-plus-n@3x.png" alt="" width="16"></a>
	                  </div>
	                </div>
	                <div class="btn-wrap">
	                  <a href="#" class="btn btn-round next1" data-text="AD_0023_02" id="next13">다음</a>
	                </div>
	              </div>

	            </div>
	          </div>

	          <!-- 배송지 -->
	          <div class="card" id="deliveryCard" style="display: none;">
	            <div class="card-header" id="headingSecondMenu" data-toggle="collapse" data-target="#collapseSecondMenu" aria-expanded="true" aria-controls="collapseSecondMenu">
	              <div class="title-area">
	                <span class="title text-ellipsis" data-text="AD_0028_01">배송지</span>
	                <a href="#" class="btn-accordion" id="accordian2"><span class="img"></span></a>
	              </div>
	              <div class="t-selected">
	                <span id="selectAddress" class="highlight" data-text="AD_0025_04">선택 미완료</span>
	              </div>
	            </div>
	            <div id="collapseSecondMenu" class="collapse" aria-labelledby="headingSecondMenu" data-parent="#paymentAccordion">
	              <div class="card-body">
	                <div class="delivery-info">
	                  <p class="desc" data-text="AD_0028_02"><i class="required"></i>* 항목은 필수 입력 항목입니다.</p>
	                  <div class="checkbox">
	<!--                     <div class="title" data-text="AD_0028_03">배송지 선택<i class="required"></i></div> -->
	<!--                     <div class="custom-control custom-radio custom-control-inline"> -->
	<!--                       <input type="radio" id="type1" name="delivery" class="custom-control-input line"> -->
	<!--                       <label class="custom-control-label" for="type1" data-text="AD_0028_04">회원 정보와 동일</label> -->
	<!--                     </div> -->
	                    <div class="custom-control custom-radio custom-control-inline" style="display:none">
	                      <input type="radio" id="type2" name="delivery" class="custom-control-input line" checked="">
	                      <label class="custom-control-label" for="type2" data-text="AD_0028_05">신규 등록</label>
	                    </div>
	                  </div>
	                  <div class="form-group">
	                    <label for="rName" class="font-weight-bold tabInx1" data-text="AD_0028_06">받으시는 분<i class="required"></i></label>
	                    <input type="text" id="rName" class="form-control mandatory" tabindex="1">
	                  </div>
	                  <div class="form-group">
	                    <div class="button-group mb-0">
	                      <label for="address" class="font-weight-bold" data-text="AD_0028_07">배송지 주소<i class="required"></i></label>
	                      <input type="text" id="address1" class="form-control mb-md-0 mandatory tabInx2" tabindex="2">
	                      <button class="btn btn-outline-primary mandatory" data-text="AD_0028_08" id="getDaumPostcode">우편번호</button>
	                    </div>
	                    <input type="text" title="address" id="address2" class="form-control mb-0 float-md-right mandatory">
	                    <input type="text" title="address" id="address3" class="form-control float-md-right mandatory tabInx3" tabindex="3">
	                  </div>
	                  <!-- 우편번호 modal -->
	                  <!-- div id="zipcodeModal" class="modal fade" tabindex="-1" role="dialog" aria-modal="true">
							<div class="modal-dialog">
								Modal content
								<div class="modal-content">
									<div id="wrap" style="width: 500px; ">
										<button type="button" class="close" data-dismiss="modal" style="position: absolute; right: 0px; top: -5px; z-index: 1">
											<img  src="//t1.daumcdn.net/postcode/resource/images/close.png"  alt="접기 버튼">
										</button>
									</div>
								</div>
							</div>
						</div>
						<div id="wrap" style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
						<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
						</div> -->

	                  <div class="form-group">
	                    <label for="phone" class="font-weight-bold" data-text="AD_0028_09">휴대폰 번호<i class="required"></i></label>
	                    <div class="telephone">
	                      <select id="phone" class="custom-select form-control mandatory">
	                        <option selected="">010</option>
	                        <option>011</option>
	                        <option>016</option>
	                        <option>017</option>
	                        <option>018</option>
	                        <option>019</option>
	                      </select>
	                      <span class="line"></span>
	                      <input type="number" id="phone_m" class="form-control mandatory tabInx4" value="" title="phone" maxlength="4" oninput="maxLengthCheck(this)" tabindex="4">
	                      <span class="line"></span>
	                      <input type="number" id="phone_l" class="form-control mandatory tabInx5" value="" title="phone" maxlength="4" oninput="maxLengthCheck(this)" tabindex="5">
	                    </div>
	                  </div>
	                  <div class="form-group">
	                    <label for="phone2" class="font-weight-bold" data-text="AD_0028_10">전화 번호</label>
	                    <div class="telephone">
	                      <select id="phone2" class="custom-select form-control">
	                        <option selected="">02</option>
	                        <option>031</option>
	                        <option>032</option>
	                        <option>033</option>
	                        <option>041</option>
	                        <option>042</option>
	                        <option>070</option>
	                      </select>
	                      <span class="line"></span>
	                      <input type="number" id="phone2_m" class="form-control tabInx6" title="phone2" maxlength="4" oninput="maxLengthCheck(this)" tabindex="6">
	                      <span class="line"></span>
	                      <input type="number" id="phone2_l" class="form-control tabInx7" title="phone2" maxlength="4" oninput="maxLengthCheck(this)" tabindex="7">
	                    </div>
	                  </div>
	                  <div class="form-group">
	                    <label for="email" class="font-weight-bold" data-text="AD_0028_11">이메일</label>
	                    <div class="email">
	                      <input type="text" id="email" class="form-control tabInx8" tabindex="8">
	                      <span class="char">@</span>
	                      <input type="text" id="domain" title="email" class="form-control mr-0 tabInx9" tabindex="9">
	                      <select title="email" class="custom-select form-control" id="emailSelect">
	                        <option disabled="" selected="" data-text="AD_0028_12">선택</option>
	                        <option data-text="AD_0028_14" value="naver.com">네이버</option>
	                        <option data-text="AD_0028_15" value="daum.net">다음</option>
	                        <option data-text="AD_0028_16" value="gmail.com">구글</option>
	                        <option data-text="AD_0028_17" value="nate.com">네이트</option>
	                        <option data-text="AD_0028_18" value="hotmail.com">핫메일</option>
	<!--                         <option value="naver.com">MSN</option> -->
	                        <option data-text="AD_0028_19" value="">직접입력</option>
	                      </select>
	                    </div>
	                  </div>
	                  <div class="form-group">
	                    <label for="memo" class="font-weight-bold" data-text="AD_0034_09">배송시 요구사항</label>
	                    <textarea class="form-control tabInx10" id="memo" placeholder="한글 50자, 영문 100자 이내로 입력해주세요." data-placeholder="AD_0028_13" tabindex="10"></textarea>
	                  </div>
	                </div>
	                <div class="btn-wrap">
	                  <a href="#" class="btn btn-round disabled" data-text="AD_0023_02" id="next2">다음</a>
	                </div>
	              </div>
	            </div>
	          </div>


	          <!-- 총 결제 금액 -->
	          <div class="card">
	            <div class="card-header" id="headingThirdMenu" data-toggle="collapse" data-target="#collapseThirdMenu" aria-expanded="false" aria-controls="collapseThirdMenu">
	              <div class="title-area">
	                <span class="title text-ellipsis" data-text="AD_0033_01">총 결제 금액</span>
	                <a href="#" class="btn-accordion" id="accordian3"><span class="img"></span></a>
	              </div>
	              <div class="t-selected">
	                <span id="selectAgree" data-text="AD_0033_10">약관 동의 필요</span>
	              </div>
	            </div>
	            <div id="collapseThirdMenu" class="collapse" aria-labelledby="headingThirdMenu" data-parent="#paymentAccordion">
	              <div class="card-body">

	                <div class="total-list">
	                  <div class="total-price" id="priceInfo"><span class="price" id="price">￦99,000</span></div> <!-- (2명 X 99,000/월) -->
	                 	<input type="hidden" id="isDelivery" value="0">
	                 	<input type="hidden" id="basePrice" value="99000">
	                 	<input type="hidden" id="discountPercent" value="1">
	                 	<input type="hidden" id="totPrice" value="99000">
	                 	<input type="hidden" id="saleType" value="2">
	                 	<input type="hidden" id="contractMonth" value="12">
	                 	<input type="hidden" id="billingBeginDate" value="20211203">
	                 	<input type="hidden" id="billingEndDate" value="20221202">
	                  <p class="desc-01" data-text="AD_0033_02" id="saleTypeText_0" style="display: none;">다음 정기 결제는 현재 구독이 만료되면 시작됩니다. 갱신일 하루 전까지 마이페이지에서 취소할 수 있습니다. 취소할 때까지 구독이 자동 갱신됩니다.</p>
	                  <p class="desc-01" data-text="AD_0033_04" id="saleTypeText_1" style="display:none">약정은 결제 시 바로 시작되며, 마이페이지에서 중도 해지할 수 있습니다. 자세한 내용은 고객 센터에 문의하세요.</p>
	<!--                   <p class="desc-01" data-text="AD_0033_04">약정은 결제 시 바로 시작되며, 마이페이지에서 중도 해지할 수 있습니다. 자세한 내용은 고객 센터에 문의하세요.</p> -->
	                  <p class="desc-02 " data-text="AD_0033_05;666" id="agreementTerm" style="display: none;"><em data-text="AD_0033_05">약정 기간: </em><em id="agreementTermDate" class="font-weight-bold">YYYY. MM. DD ~ YYYY. MM. DD</em></p>
	                  <p class="desc-02 " id="agreementTermNew" style=""><em>학습 기간: </em><em id="agreementTermDateNew" class="font-weight-bold">2021. 12. 03 ~ 2022. 12. 02</em></p>
	                  <p class="desc-02" id="nextPay" style="display: none;"><em data-text="AD_0033_11">다음 결제일: </em> <span class="font-weight-bold" id="nextPayDate" data-text="AD_0033_12">YYYY. MM. DD</span><em data-text="AD_0033_13"> 결제 예정</em></p>
	                </div>

	                <div class="total-bottom">
	                  <p class="title" data-text="AD_0033_06">약관 동의<i><img src="../../img/common/icon-16-dot@3x.png" alt="" width="16"></i></p>
	                  <ul>
	                    <li>
	                      <div class="custom-control custom-checkbox d-inline-block mr-2 mr-rem-md-1">
	                        <input type="checkbox" class="custom-control-input" id="list1">
	                        <label class="custom-control-label" for="list1" data-text="AD_0033_07">개인정보수집 약관 동의(필수)</label>
	                      </div>
	                      <a href="#" data-text="AD_0033_09" id="terms1">자세히 보기</a>
	                    </li>
	                    <li>
	                      <div class="custom-control custom-checkbox d-inline-block mr-2 mr-rem-md-1">
	                        <input type="checkbox" class="custom-control-input" id="list2">
	                        <label class="custom-control-label" for="list2" data-text="AD_0033_08">환불 규정 안내 동의(필수)</label>
	                      </div>
	                      <a href="#" data-text="AD_0033_09" id="terms2">자세히 보기</a>
	                    </li>
	                  </ul>
	                </div>
	              </div>
	            </div>
	          </div>
	        </div>
	      </div>

	      <!-- 버튼 영역 -->
	      <div class="btn-wrap">
	        <a href="#" class="btn btn-outline btn-round" data-toggle="modal" data-target="#cancelModal" data-text="AD_0034_01">취소</a>
	        <a href="#" class="btn btn-round disabled" id="pay">결제</a>
	      </div>
	    </div>

	    <!-- E contents -->
	  </div>
	  </div>
  </div>
  <!-- ###ui-detail-box -->
</div>

	<!-- 취소 Modal -->
    <div class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-body">
              결제를 취소하시겠습니까?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-outline-primary " data-dismiss="modal" aria-label="Close" data-text="AD_0034_04">아니오</button>
              <button type="button" class="btn btn-sm com-modal-btn" data-dismiss="modal" onclick="goProductDetail();" data-text="AD_0034_05">예</button>
            </div>
          </div>
        </div>
    </div>


<!-- include fixed-btn -->
    <div id="fixed"><div class="fixed-btn">
	<ul>
		<li><a href="/webapp/html/customerCenter/customerCenter.html" class="cs"><img src="../../img/common/btn-cs-n@2x.png"><span data-text="CC_0001_01">고객센터</span></a></li>
        <li><a href="#" class="top" style="display:none"><img src="../../img/common/btn-top-n.png"></a></li>
    </ul>
</div>
<script>
$(document).ready(function() {

	$(window).scroll(function(event){
		if(document.documentElement.scrollTop < 5){
			$(".top").hide();
		}else{
			$(".top").show();
		}
	});

	$(".top").click(function(e){
		onClickEventPrevent(e);
		scrollTop();
	});
});
</script></div>

    <!-- include footer -->
    <div id="footer"><footer>
	<div class="container-footer">
		<div class="policy">
		    <ul class="clearfix">
		        <li class="item"><a href="javascript:;" onclick="openNewBrowser('http://www.i-screamedu.co.kr/www/about01.html')" data-text="CU_0018_01">회사소개</a></li>
		        <li><a href="/webapp/html/common/termsofuse.html" data-text="CU_0018_02">이용약관</a></li>
		        <li><a href="/webapp/html/common/termsofuse.html?termsType=3" data-text="CU_0018_03">개인정보 처리방침</a></li>
		    </ul>
		</div>
		<div class="family">
		    <div class="input-group">
		        <select name="" id="familySite" style="background-color:white;" class="familySite">
					<option value="#" data-text="CU_0018_12">Family Site</option>
          			<option value="https://www.home-learn.co.kr/main/Index.do" data-text="CU_0018_13">아이스크림홈런</option>
          			<option value="https://www.schooling.co.kr/" data-text="CU_0018_14">아이스크림홈런중등</option>
			        <option value="http://www.i-screamedu.co.kr/index.do" data-text="CU_0018_15">아이스크림에듀</option>
			        <option value="https://www.i-screammedia.com/index.do" data-text="CU_0018_16">아이스크림미디어</option>
			        <option value="http://www.i-scream.co.kr/user/main/MainPage.do?sso=ok" data-text="CU_0018_17">아이스크림</option>
			        <option value="https://www.i-screammall.co.kr/main/index" data-text="CU_0018_18">아이스크림몰</option>
			        <option value="http://teacher.i-scream.co.kr/index.do?sso=ok" data-text="CU_0018_19">아이스크림연수원</option>
		        </select>
		    </div>
		</div>
		<address>
	      <p>
	        <span class="address">
	          <em class="footer-company">(주)아이스크림에듀</em>
	          <span class="dp-block">
	            <em class="footer-address"> 서울특별시 강남구 테헤란로88길 15</em>
	            <em class="footer-ceo" data-text="CU_0018_05">대표 : 조용상</em>
	          </span>
	          <span class="dp-block">
	            <em class="footer-tel" data-text="CU_0018_06">상담 및 문의전화 : 1544-0910</em>
	            <em class="footer-fax" data-text="CU_0018_07">팩스 : (02)3448-5262</em>
	          </span>
	          <em class="footer-operator-num" data-text="CU_0018_08">사업자등록번호 : 120-87-97004</em>
	          <em class="footer-sale-num" data-text="CU_0018_09">통신판매신고번호 : 제2013-서울강남-01379호</em><br>
	          <em class="footer-hosting" data-text="CU_0018_10">호스팅사이버자 : AWS</em>
	        </span>
	        <span class="copyright" data-text="CU_0018_11">Copyright ⓒ i-Scream edu Corporation all rights reserved.</span>
	      </p>
	    </address>
	</div>
</footer></div>

<!-- E content -->

<!-- <script src="../../js/bundle.js"></script> -->
<script src="../../js/init.js"></script><script type="text/javascript" src="../../js/lang/lang.js"></script>
<script type="text/javascript" src="../../js/bundle.js"></script>
<script type="text/javascript" src="../../js/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../../js/lib/jquery.ui.touch-punch.min.js"></script>
<script type="text/javascript" src="../../js/lib/jquery-touch-events.js"></script>
<script type="text/javascript" src="../../js/lib/moment.min.js"></script>
<script type="text/javascript" src="../../js/common.js?Fri Dec 03 2021 15:29:12 GMT+0900 (한국 표준시)"></script>
<script type="text/javascript" src="../../js/sha256.js"></script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5YFB48GLR1"></script>
<script type="text/javascript" src="../../js/lib/aes.js"></script><script type="text/javascript" src="../../js/common_mk.js"></script><script type="text/javascript" src="../../js/lib/mode-ecb.js"></script>
<script>

// var loginType = sessionStorage.getItem("loginType");
// var loginSid = sessionStorage.getItem("loginSid");
var loginType = getCookie("loginType");
var loginSid = getCookie("loginSid");
var data = {};
// var loginType = null;
var inputCheck = false;
var productBroYn = "N"; //일반적으론 N
var testerYn = 'N';
var testProdYn = 'N';

//결제 실패 에러코드
var errCode  = $.getUrlParam("errCode");
var saleProductCode  = $.getUrlParam("saleProductCode");
data.saleProductCode = saleProductCode;

$(document).ready(function() {

	var location = window.location.pathname ? window.location.pathname : "" ;
	var path = "/webapp/html";
	location = location.replace(path, "");

	//결제 거쳤던 정보 삭제
	sessionStorage.removeItem('spc');
	sessionStorage.removeItem('ordrIdx');

	if (sessionStorage.getItem("refresh") == "true") {
	    history.pushState(null, '' , '/webapp/html/main/main.html');
		location.replace('/webapp/html/main/main.html');
	    sessionStorage.removeItem("refresh");
// 	    window.location.reload();
	}

	//로딩바 나오고 있었다면, 숨기기
	hideLoadingbar();

	//공통 import
	includeHTML('', function(){
		$("h2.top-sub-title").text(commonMessage("AD_0034_08"));
// 		$("h2.top-sub-title").text("결제");
		setLanguage(".navbar-sub .title");
		$(".navbar-sub").addClass("event").addClass("px-rem-md-3").addClass("px-rem-2");
	});

	var memberTypeGl = Global.reqCommonData.memberType;

	if(memberTypeGl == null || memberTypeGl == ""){
		commonAlert('CU_0002_06', '', function(){
			location.replace('/webapp/html/main/main.html');
			return;
		});
	}

	//errCode팝업
	if(errCode != null && errCode != '' ){
		if(errCode == '3003'){

// 			alert('잘못된 접근입니다. ');

		}else{
			if(sessionStorage.getItem('errShown') != "Y"+saleProductCode ){
				hideLoadingbar();
				commonAlert('CU_0002_05');
// 				alert('결제 요청시 에러가 발생했습니다. \n 잠시 후 다시 이용해 주세요. ');
				sessionStorage.setItem('errShown', "Y"+saleProductCode);

			}

		}
	}else{
		sessionStorage.removeItem('errShown');
	}


// 	if(sessionStorage.getItem("testerYn") == "Y" || sessionStorage.getItem("testerYn") == "S"){
	if(getCookie("testerYn") == "Y" || getCookie("testerYn") == "S"){
		testerYn = "Y";
	}

	//기본 상세내용
	fnDetailSearch(data);

	//기본 사용자 정보화면세팅
 	fnUserInfo();

	//orderId생성
// 	$('#orderId').val(initOrderid());
// 	console.log('orderId:'+initOrderid());


	 $("#phone_m").keyup (function () {
		var charLimit = $(this).attr("maxlength");
        if (this.value.length >= charLimit) {
            $('#phone_l').focus();
            return false;
        }
    });

	 $("#phone_l").keyup (function () {
			var charLimit = $(this).attr("maxlength");
	        if (this.value.length >= charLimit) {
	            $('#phone2').focus();
	            return false;
	        }
	    });

    $("#phone2_m").keyup (function () {
		var charLimit = $(this).attr("maxlength");
        if (this.value.length >= charLimit) {
        	$('#phone2_l').focus();
            return false;
        }
    });

    $("#phone2_l").keyup (function () {
		var charLimit = $(this).attr("maxlength");
        if (this.value.length >= charLimit) {
            $('#email').focus();
            return false;
        }
    });


	//전체 선택
	$('#selectAllText').on('click', function(){
		if($('#selectAll').data("selected") == "all"){

			//전체해제
			$('#selectAllText').text(commonMessage('AD_0025_01'));
		 	$('#studentBroList input[name="studentBro"]').each(function (i, elements) {
				if(!$(this).prop('disabled')){
					$('#selectAll').data("selected", "none");
					$(this).prop('checked', false);
				}
		 	});

			//꺼질떄
			$('.next1').addClass('disabled');
			$('#pay').addClass('disabled');
			$('#qty').val(0);
		}else{
			//전체선택
			$('#selectAllText').text(commonMessage('AD_0025_02'));
			$('#studentBroList input[name="studentBro"]').each(function (i, elements) {
				if(!$(this).prop('disabled')){
					$('#selectAll').data("selected", "all");
					$(this).prop('checked', true);
				}
		 	});
			$('.next1').removeClass('disabled');

			//약관 체크
			if($('#list1').prop('checked') && $('#list2').prop('checked')){

				//다자녀 다중 선택 기능 없음 20210426
				if(productBroYn == "Y" || loginType == 1) {

					if(!$("#next12").hasClass('disabled')){
						$('#selectAgree').text(commonMessage('AD_0033_10'));
						if($('#isDelivery').val() == "0"){
							$('#pay').removeClass('disabled');
						}else if(inputCheck){//주소지 정보도 정상이면
							$('#pay').removeClass('disabled');
						}
					}
				}else{
					$('#selectAgree').text(commonMessage('AD_0033_10'));
					if($('#isDelivery').val() == "0"){
						$('#pay').removeClass('disabled');
					}else if(inputCheck){//주소지 정보도 정상이면
						$('#pay').removeClass('disabled');
					}
				}

			}else{
				$('#pay').addClass('disabled');
				$('#selectAgree').text(commonMessage('AD_0033_10'));
			}

		}


		if(loginType == 1){
			//개수++
			fnQtyStudentPrice();
// 			$('#qty').val($('#studentBroList input[name="studentBro"]:checked').length);
		}else {
			//학부모의 경우 다자녀 제한(//다자녀 다중 선택 기능 없음 20210426)
			if($('#studentBroList input[name="studentBro"]:checked').length > data.useAccount){
				$('#next12').addClass('disabled');
				$('#pay').addClass('disabled');
			}
		}
	});

	$('#accordian3').on('click', function(){
		if($('#list1').prop('checked') && $('#list2').prop('checked')){
			$('#selectAgree').text($('#price').text());
			$('#selectAgree').addClass('highlight');
		}else{
			$('#selectAgree').text(commonMessage('AD_0033_10'));
			$('#selectAgree').removeClass('highlight');
		}
	});


	//다음
	$('.next1').on('click', function(){
		if($('#isDelivery').val() == '0'){
		//배송상품이 아닌경우
			$('#accordian3').trigger('click');
			$('#headingThirdMenu').trigger('click');
		}else{
			$('#accordian2').trigger('click');
			$('#headingSecondMenu').trigger('click');
		}


		if($(this).attr('id') == 'next12'){
			var selecedCnt = $('#studentBroList input[name="studentBro"]:checked').length;
			if(selecedCnt < 1){
				console.log('학습할 학생을 선택하세요.');
				return;
			}else{

				var nm = '';
				 $('#studentBroList input[name="studentBro"]:checked').each(function (i, elements) {
					 nm = $(elements).data('selectname');
					 if(nm != ''){
						 return;
					 }
				});

				//탭에 표시 :'홍길동외1명'
				var cnt = $('#studentBroList input[name="studentBro"]:checked').length;
				var txt = "";
				if(cnt > 1){
					cnt = cnt-1;
					txt = nm + '외 '+cnt+'명';
				}else{
					txt = nm ;
				}

				if(loginType == 1){
					//개수++
					fnQtyStudentPrice();
// 					$('#qty').val($('#studentBroList input[name="studentBro"]:checked').length);
				}

				$('#selectStudent').data('text','AD_0025_05');
				$('#selectStudent').text(txt);
				setLanguage('#selectStudent');
			}
		}

		inputMandCheck();
	});

	$('#headingThirdMenu').on('click', function(){

		//다자녀 다중 선택 기능 없음 20210426
		if(loginType == '1' || (loginType == '0' && productBroYn == 'Y') || (loginType == '2' && productBroYn == 'Y') ){
			var selecedCnt = $('#studentBroList input[name="studentBro"]:checked').length;
			if(selecedCnt < 1){
				console.log('학습할 학생을 선택하세요.');
				$('#title1_1').trigger('click');
				return;
			}else{

				var nm = '';
				 $('#studentBroList input[name="studentBro"]:checked').each(function (i, elements) {
					 nm = $(elements).data('selectname');
					 if(nm != ''){
						 return;
					 }
				});

				//탭에 표시 :'홍길동외1명'
				var cnt = $('#studentBroList input[name="studentBro"]:checked').length;
				var txt = "";
				if(cnt > 1){
					cnt = cnt-1;
					txt = nm + '외 '+cnt+'명';
				}else{
					txt = nm ;
				}

				if(loginType == 1){
					//개수++
					fnQtyStudentPrice();
//					$('#qty').val($('#studentBroList input[name="studentBro"]:checked').length);
				}

				$('#selectStudent').data('text','AD_0025_05');
				$('#selectStudent').text(txt);
				setLanguage('#selectStudent');

				inputMandCheck();

			}
		}


	});


	//형제상품의 경우 //다자녀 다중 선택 기능 없음 20210426
	$('#accordian1').on('click', function(){
		if(productBroYn == "Y" || loginType == 1){
			var nm = '';
			 $('#studentBroList input[name="studentBro"]:checked').each(function (i, elements) {
				 nm = $(elements).data('selectname');
				 if(nm != ''){
					 return;
				 }
			});

			//탭에 표시 :'홍길동외1명'
			var cnt = $('#studentBroList input[name="studentBro"]:checked').length;
			var txt = "";
			if(cnt > 1){
				cnt = cnt-1;
				txt = nm + '외 '+cnt+'명';
			}else{
				txt = nm ;
			}
			$('#selectStudent').data('text','AD_0025_05');
			$('#selectStudent').text(txt);
			setLanguage('#selectStudent');
		}
	});

	//필수 입력항목 작성시 다음 버튼 활성화
	$('#next2').on('click', function(){
		inputCheck = true;
		$('#selectAddress').text($('#address2').val());
		$('#accordian3').trigger('click');
		$('#list1').prop('checked', false);
		$('#list2').prop('checked', false);

		inputMandCheck();

		/*
		if($('#rName').val() != '' && $('#address1').val() != '' && $('#address2').val() != ''  && $('#address3').val() != ''
			&& $('#phone').val() != '' && $('#phone_m').val() != ''&& $('#phone_l').val() != '' ){
			$('#next2').removeClass('disabled');
			inputCheck = true;
		}else{
			$('#next2').addClass('disabled');
			inputCheck = false;
		} */
	});
	/*
	$('#accordian2').click(function(){
		$('#selectAddress').text($('#address2').val());
	}); */

	$('#address1').on('focus', function(){
		var text = $('#address1').val();
// 		alert('우편번호를 검색해 주세요.');
		$('#address1').val(text);
		$('#getDaumPostcode').trigger('click');
	})

	//변경 감지
	$(".mandatory").on({
		'change': function(){

			if($('#rName').val() != '' && $('#address1').val() != '' && $('#address2').val() != ''  && $('#address3').val() != ''
					&& $('#phone').val() != '' && $('#phone_m').val() != ''&& $('#phone_l').val() != ''
					&& $("input:radio[name=name]:checked").val() !='' &&$("input:radio[name=name]:checked").val() != undefined){
				$('#next2').removeClass('disabled');

				inputCheck = true;
			}else{
				$('#next2').addClass('disabled');
				inputCheck = false;
			}
		},
		'click': function(){
			if($('#rName').val() != '' && $('#address1').val() != '' && $('#address2').val() != ''  && $('#address3').val() != ''
					&& $('#phone').val() != '' && $('#phone_m').val() != ''&& $('#phone_l').val() != ''
					&& $("input:radio[name=name]:checked").val() !='' &&$("input:radio[name=name]:checked").val() != undefined){
				$('#next2').removeClass('disabled');

				inputCheck = true;
			}else{
				$('#next2').addClass('disabled');
				inputCheck = false;
			}

		},
		'keydown': function(){
			if($('#rName').val() != '' && $('#address1').val() != '' && $('#address2').val() != ''  && $('#address3').val() != ''
					&& $('#phone').val() != '' && $('#phone_m').val() != ''&& $('#phone_l').val() != ''
						&& $("input:radio[name=name]:checked").val() !='' &&$("input:radio[name=name]:checked").val() != undefined ){
				$('#next2').removeClass('disabled');

				inputCheck = true;
			}else{
				$('#next2').addClass('disabled');
				inputCheck = false;
			}

		}
	});



	//약관 동의
	$('.custom-checkbox').change(function(){
		inputMandCheck();
	});




	//TODO
	//수량 변경 감지(선생님)
// 	$(".count-num a").on('click',function(){
/* 	$('#studentBroList d').on('click',function(){
		alert('학생선택?');

		fnQtyStudentPrice();
	}); */



	// 이메일 도메인 선택
	$('#emailSelect').on('change', function() {
		var domain = $(this).val();
		var email = $('#email').val();
		if(email.indexOf('@' > -1)) {
			$('#email').val(email.split('@')[0]);
			$('#domain').val(domain);
		}else {
			$('#domain').val(domain);
		}
		$('#email').blur();
	});


	//약관 자세히보기
	$('#terms1').on('click', function(){
		var selectid = "";
		if(productBroYn == "Y"){//학생 다중 선택인 경우//다자녀 다중 선택 기능 없음 20210426
		 	$('#studentBroList input[name="studentBro"]:checked').each(function (i, elements) {
		 		if(i == 0){
		  		selectid += $(elements).data('selectid');
		   	}else{
		    	selectid += ','+$(elements).data('selectid');
		   	}
		   });
		}else{
		  	selectid = $("input:radio[name=name]:checked").data('selectid');
		}

		sessionStorage.setItem('list1', $('#list1').prop('checked')?"true":"false");
		sessionStorage.setItem('list2', $('#list2').prop('checked')?"true":"false");
		sessionStorage.setItem('inputCheck', inputCheck);
		sessionStorage.setItem('chkStudent', selectid);
		sessionStorage.setItem('phone1', $("#phone").val());
		goTerms(1);
	});
	$('#terms2').on('click', function(){
		var selectid = "";
		if(productBroYn == "Y"){//학생 다중 선택인 경우//다자녀 다중 선택 기능 없음 20210426
		 	$('#studentBroList input[name="studentBro"]:checked').each(function (i, elements) {
		 		if(i == 0){
		  		selectid += $(elements).data('selectid');
		   	}else{
		    	selectid += ','+$(elements).data('selectid');
		   	}
		   });
		}else{
		  	selectid = $("input:radio[name=name]:checked").data('selectid');
		}

		sessionStorage.setItem('list1', $('#list1').prop('checked')?"true":"false");
		sessionStorage.setItem('list2', $('#list2').prop('checked')?"true":"false");
		sessionStorage.setItem('inputCheck', inputCheck);
		sessionStorage.setItem('chkStudent', selectid);
		sessionStorage.setItem('phone1', $("#phone").val());
		goTerms(2);
	});


	//결제버튼
	$('#pay').on('click', function(){
		sessionStorage.removeItem('errShown');
		sessionStorage.removeItem('payPopup'+saleProductCode);

		if(testProdYn == "Y"){
			commonAlert('테스터계정으로 무료 결제로 진행됩니다.', '', function(){
				pay();
			});
		}else{
			pay();
		}
	});



	//사용안함----- 배송지 선택(회원 정보의 배송지 정보 조회)
	/*$('#type1').on('click', function(){
		//아이스크림 API 사용
		$('#rName').val('');
		$('#address1').val('');
		$('#address2').val('');
		$('#address3').val('');
		$('#phone option:eq(0)').prop('selected', true);
		$('#phone_m').val('');
		$('#phone_l').val('');
		$('#phone2 option:eq(0)').prop('selected', true);
		$('#phone2_m').val('');
		$('#phone2_l').val('');
		$('#email').val('');
		$("#emailSelect option:eq(0)").prop('selected', true);
		$('#memo').val('');
	});
	*/

	//배송지 신규등록(초기화)
	$('#type2').on('click', function(){
		$('#rName').val('');
		$('#address1').val('');
		$('#address2').val('');
		$('#address3').val('');
		$('#phone option:eq(0)').prop('selected', true);
		$('#phone_m').val('');
		$('#phone_l').val('');
		$('#phone2 option:eq(0)').prop('selected', true);
		$('#phone2_m').val('');
		$('#phone2_l').val('');
		$('#email').val('');
		$("#emailSelect option:eq(0)").prop('selected', true);
		$('#memo').val('');

	});

	//모바일 소프트키 '이동' 적용
	$('input').bind('keydown', function(e) {
		  if(e.keyCode == '13') {
		    var no = $(this).attr('tabindex')*1+1;
		    $('.tabInx'+no+'').focus();

		}
	});


});



var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
var validateEmail = function(email) {
	var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
	if (email == '' || !re.test(email)) {
		console.log("올바른 이메일 주소를 입력하세요");
		return false;
	}else{
		return true;
	}
}

//필수 체크
function inputMandCheck(){
	if($('#list1').prop('checked') && $('#list2').prop('checked') && $("input:radio[name=name]:checked").val() !='' && $("input:radio[name=name]:checked").val() != undefined){
		if(productBroYn == "Y" || loginType == 1) {//다자녀 다중 선택 기능 없음 20210426
			if(!$("#next12").hasClass('disabled')){
				$('#selectAgree').text(commonMessage('AD_0033_10'));
				if($('#isDelivery').val() == "0"){
					$('#pay').removeClass('disabled');
					$('#selectAgree').text($('#price').text());
					$('#selectAgree').addClass('highlight');
				}else if(inputCheck){//주소지 정보도 정상이면
					$('#pay').removeClass('disabled');
					$('#selectAgree').text($('#price').text());
					$('#selectAgree').addClass('highlight');
				}
			}
		}else{
			$('#selectAgree').text(commonMessage('AD_0033_10'));
			if($('#isDelivery').val() == "0"){
				$('#pay').removeClass('disabled');
				$('#selectAgree').text($('#price').text());
				$('#selectAgree').addClass('highlight');
			}else if(inputCheck){//주소지 정보도 정상이면
				$('#pay').removeClass('disabled');
				$('#selectAgree').text($('#price').text());
				$('#selectAgree').addClass('highlight');
			}
		}

	}else{
		$('#pay').addClass('disabled');
		$('#selectAgree').text(commonMessage('AD_0033_10'));
	}
}

//학생수 가격계산
function fnQtyStudentPrice(){
	//B2B인 경우만
	if( loginType == 1){
		$('#qty').val($('#studentBroList input[name="studentBro"]:checked').length);

		var price = $('#monthPrice').data('price');

		//수량탭
		if($('#saleType').val() == '3' || price == '0'){
			$('#monthPrice').html('<em class="font-weight-bold" date-text="AD_0034_18">무료</em>');
			$('#pay').text('이용하기');
			setLanguage('#monthPrice');
		}else{

			$('#monthPrice').html('<em class="font-weight-bold">￦'+commaNum(price*1*$('#qty').val())+'</em> / <em data-text="CU_0029_07">월</em>');
			setLanguage('#monthPrice');

		}
		$('#selectStudent').data('text','AD_0026_02;'+$('#qty').val());

//			$('#selectStudent').html($('#qty').val()+'<em data-text="AD_0026_02">개</em>');
	// 	$('#selectStudent').data('text','AD_0026_02;'+$('#qty').val());
		setLanguage('#selectStudent');

		if($('#qty').val() == "0" ){
			$('.next1').addClass('disabled');
		}else{
			$('.next1').removeClass('disabled');
		}

		//총 결제금액 탭
		var payPrice = price*1*$('#qty').val()*$('#discountPercent').val();

		if($('#saleType').val() == "2"  ){
			$('#priceInfo').html('<span class="price" id="price">￦'+commaNum(payPrice)+'</span>')
		}else if($('#saleType').val() == "3"  ){
			$('#priceInfo').html('<span class="price" id="price" date-text="AD_0034_18"></span>')
		}else{
			$('#priceInfo').html('<span class="price" id="price">￦'+commaNum(payPrice)+'</span> / <em data-text="CU_0029_07">월</em> ('+$('#qty').val()+'<em data-text="AD_0026_02">개</em> X ￦'+ commaNum(price)+')') //(2명 X 99,000/월)
		}
// 		$('#priceInfo').data('text', 'MY_0023_01;'+price*1*$('#qty').val()+';'+price);
		setLanguage('#priceInfo');
		$('#totPrice').val(price*1*$('#qty').val()*$('#discountPercent').val());
		$('#basePrice').val(price*1*$('#qty').val()*$('#discountPercent').val());

	}


}

//선택 학생 명 표시
$(document).on("click","input:radio[name=name]",function(){
	$('#selectStudent').text($("input:radio[name=name]:checked").data('selectname'));
});


$(document).on("click",'#studentBroList input[name="studentBro"]',function(){

	if(productBroYn == "Y"|| loginType == 1){//다자녀 다중 선택 기능 없음 20210426
		if($('#studentBroList input[name="studentBro"]:checked').length == 0){
			$('#selectAllText').text(commonMessage('AD_0025_01'));
		}

		if( loginType == 1){
			if($('#studentBroList input[name="studentBro"]:checked').length >= 1){

				$('#next12').removeClass('disabled');
				$('#pay').addClass('disabled');
				//약관도 체크
				if($('#list1').prop('checked') && $('#list2').prop('checked')){
					$('#selectAgree').text(commonMessage('AD_0033_10'));
					if($('#isDelivery').val() == "0"){
						$('#pay').removeClass('disabled');
					}else if(inputCheck){//주소지 정보도 정상이면
						$('#pay').removeClass('disabled');
					}
				}
			}else{
				$('#next12').addClass('disabled');
				$('#pay').addClass('disabled');
			}
			fnQtyStudentPrice();

		}else{
			if($('#studentBroList input[name="studentBro"]:checked').length < 2){
				$('#next12').addClass('disabled');
				$('#pay').addClass('disabled');
			}else if($('#studentBroList input[name="studentBro"]:checked').length > data.useAccount){
				$('#next12').addClass('disabled');
				$('#pay').addClass('disabled');
			}else if($('#studentBroList input[name="studentBro"]:checked').length > 2){
				$('#next12').removeClass('disabled');
				$('#pay').addClass('disabled');
				//약관도 체크
				if($('#list1').prop('checked') && $('#list2').prop('checked')){
					$('#selectAgree').text(commonMessage('AD_0033_10'));
					if($('#isDelivery').val() == "0"){
						$('#pay').removeClass('disabled');
					}else if(inputCheck){//주소지 정보도 정상이면
						$('#pay').removeClass('disabled');
					}
				}
			}else{
				$('#next12').removeClass('disabled');
				//약관도 체크
				if($('#list1').prop('checked') && $('#list2').prop('checked')){
					$('#selectAgree').text(commonMessage('AD_0033_10'));
					if($('#isDelivery').val() == "0"){
						$('#pay').removeClass('disabled');
					}else if(inputCheck){//주소지 정보도 정상이면
						$('#pay').removeClass('disabled');
					}
				}
			}
		}



	}else{
		if($('#studentBroList input[name="studentBro"]:checked').length < 1){
			$('#next12').addClass('disabled');
			$('#pay').addClass('disabled');
		}else{
			$('#next12').removeClass('disabled');
		}
	}
});



var maxLengthCheck = function(object){
	if (object.value.length > object.maxLength){
    	object.value = object.value.slice(0, object.maxLength);
    }
}

//상품정보
var fnDetailSearch = function(data){
	$.postJSON("/marketplace/product/buyInfo", data, fnProductDetail , false);


}

//상품정보 세팅
var fnProductDetail = function(resData){
	if(loginSid == null){
		//로그아웃인 경우
		commonAlert('CU_0002_04');
		goProductDetail();
		return;
	}else if($.isEmpty(loginType)){
		//학생의 경우 진입할 수 없음
		goProductDetail();
		return;
	}
//console.log(resData);
	var totalCnt = 0;
	if(!$.isEmpty(resData)){
		//판매중지 상품은 조회 조건에서 빠지므로,
		if(resData.product == null ){
			//판매가 중지되었어요
			//아얘 상품 정보가 없는 경우
			commonAlert(commonMessage("AD_0006_12"), {title : commonMessage("AD_0006_11")}, function(){
				location.replace("/webapp/html/main/main.html");
			});

		}else if(resData.product.saleState != '3' && testerYn == 'N'){
			commonAlert(commonMessage("AD_0006_12"), {title : commonMessage("AD_0006_11")}, function(){
				window.history.back()
// 				location.replace("/webapp/html/product/detail.html?saleProductCode="+saleProductCode);
			});
		}else{

			//테스터의 테스트 상품인지 여부
			testProdYn = resData.product.testProdYn;

			data.useAccount = resData.product.useAccount;
			//다자녀 다중 선택하는 기능 없으므로 삭제 20210426
// 			if(data.useAccount > 1){
// 				productBroYn = "Y";
// 			}else{
				productBroYn = "N";
// 			}
			$('#title').text(resData.product.productName);
			$('#brandName').text(resData.product.brandName);
			$('#star').text(resData.product.starCount);
			var discount = 1;

			if(resData.product.discountBadgeYn == "Y"){
				discount = 1-resData.product.discountPercent;
				$('#discountPercent').val(discount);
			}else{
				discount = 1;
				$('#discountPercent').val(discount);
			}
			var contractMonth = 1;
			if(resData.product.contractMonth != null && resData.product.contractMonth > 1){
				contractMonth = resData.product.contractMonth;
			}
			$('#mainIcon').attr('src', resData.product.icon);
	// 		var totPrice = resData.product.price*1*resData.product.contractMonth;
			var totPrice = (resData.product.price*1*discount);
			//총 결제금액 탭
	// 		var payPrice = totPrice*1*contractMonth;

			$('#totPrice').val(totPrice);
			$('#basePrice').val(resData.product.price*1*discount);
			$('#saleType').val(resData.product.saleType);
			$('#contractMonth').val(contractMonth);

			if(resData.product.saleType == '3' || resData.product.price == '0'){
				$('#pay').text('이용하기');
			}

			//배송상품여부
			$('#isDelivery').val(resData.product.isDelivery);
			if(resData.product.isDelivery == '0'){
				$('#deliveryCard').css('display','none');
			}else{
				$('#deliveryCard').css('display','');
			}

			$('#agreementTermNew').hide();

			//다음 결제일 계산
			var mth = contractMonth*1; //약정개월수
			var today = new Date();
			var date = new Date();
// 			console.log('기준일:'+ today);
			date.setDate(date.getDate() -1 );
			date = addMonth(date, mth);
// 			console.log('3달 후 : ' + date);

// 			date.setMonth(date.getMonth()+mth); //월 계산
			//학습 기간: 결제일-1
			var month = ( date.getMonth() +1 );

			var nxth = 1; //매달 결제므로 약정 개월로 계산하지 않음
			var nxdate = new Date();
			nxdate.setMonth(nxdate.getMonth()+nxth); //월 계산
			var nxmonth = ( nxdate.getMonth() +1 );

			//학습시작일 종료일 세팅
			var billingBeginDate = today.getFullYear() +". "+ makePadZero(today.getMonth()+1) +". "+makePadZero(today.getDate()); //오늘
			var billingEndDate = date.getFullYear() +". "+ makePadZero(month) +". "+makePadZero(date.getDate());
			$('#billingBeginDate').val(today.getFullYear() +""+ makePadZero(today.getMonth()+1) +""+makePadZero(today.getDate()));
			$('#billingEndDate').val(date.getFullYear() +""+ makePadZero(month) +""+makePadZero(date.getDate()));

			//saleType 0:약정결제 1:무제한정기결제 2:1회성결제
			if(resData.product.saleType == '2'){
				//1회성 결제 표시X
				$('#saleTypeText_0').css('display','none');
				$('#saleTypeText_1').css('display','none');
				$('#nextPay').hide();
				$('#agreementTerm').hide();
				$('#priceInfo').html('<span class="price" id="price">￦'+commaNum(totPrice)+'</span>');
				//9월 오픈
				if( !$.isEmpty(resData.product.contractMonth) && resData.product.contractMonth > 1){ //1회성 결제이면서 학습 기간이 있는 경우 표시
					var billingBeginDate = today.getFullYear() +". "+ makePadZero(today.getMonth()+1) +". "+makePadZero(today.getDate()); //오늘
					var billingEndDate = date.getFullYear() +". "+ makePadZero(month) +". "+makePadZero(date.getDate());


					$('#agreementTermDateNew').text( billingBeginDate + ' ~ ' + billingEndDate);
					$('#agreementTermNew').show();
				}
				setLanguage('#priceInfo');
			}else{
				if($('#saleType').val() == "3"  ){
					$('#priceInfo').html('<span class="price" id="price">'+commonMessage('AD_0034_18')+'</span>') ;
				}else{
					$('#priceInfo').html('<span class="price" id="price">￦'+commaNum(totPrice)+'</span><p> (￦'+commaNum($('#basePrice').val())+' / '+commonMessage('CU_0029_07')+')<p>'); //(2명 X 99,000/월)
				}
				setLanguage('#priceInfo');


	// 			$('#saleTypeText').show();
				$('#nextPay').show();

				$('#nextPayDate').text(nxdate.getFullYear() +". "+ makePadZero(nxmonth) +". "+ makePadZero(nxdate.getDate()) );


				//0:약정
				if(resData.product.saleType == '0'){
	// 				$('#saleTypeText').text('다음 정기 결제는 현재 구독이 만료되면 시작됩니다. 다음 결제일 하루 전까지 마이페이지에서 취소할 수 있습니다. 취소할 때까지 구독이 자동 갱신됩니다.');
					$('#saleTypeText_0').css('display', '');
					$('#saleTypeText_1').css('display', 'none');
					$('#agreementTermDate ').text(billingBeginDate + ' ~ ' + billingEndDate)
					//약정 기간     2020. 12. 02 ~ 2021. 06. 02
					//다음 결제일  2020. 12. 02 결제 예정
					$('#agreementTerm').show();

				//1:무제한정기(구독)
				}else if(resData.product.saleType == '1'){
					$('#saleTypeText_0').css('display', 'none');
					$('#saleTypeText_1').css('display', '');
					$('#agreementTerm').hide();

				}else{//case X
					$('#saleTypeText_0').css('display','none');
					$('#saleTypeText_1').css('display','none');
					$('#nextPay').hide();
					$('#agreementTerm').hide();
					$('#agreementTermNew').hide();
				}
			}

			//학부모인 경우 & 1계정 상품인 경우 ; //0=학학부모
			if(!$.isEmpty(resData.studentList)){
				if(loginType == 0 || loginType == 2){
	// 				console.log("productBroYn> "+productBroYn);

					//다자녀 다중 선택 기능 없음 20210426
					if(productBroYn == "Y"){
						//다계정 상품의 경우
						$('#title1_1').css('display','');
						$('#title1_1').data('text','AD_0023_01');
						$('#title1_2').css('display','none');

						$('#selectText').text(commonMessage('AD_0025_08', data.useAccount));
						$('#studentBroInfo').css('display', 'block');
						if( resData.product.buyer == 2){
							//학습관 전용 상품 안내
							$('#studentBroInfo .infoText').css('display','');
						}else{
							$('#studentBroInfo .infoText').hide();
						}
						$('#studentInfo').css('display', 'none');
						$('#monthInfo').css('display', 'none');

						var studentHtml = "";
						$.each(resData.studentList, function(index, item){
							studentHtml += '<li>';
							studentHtml += '    <div class="custom-control custom-checkbox custom-control-inline">';
							//학습중
							if(item.subscribeYn == "Y"){
								studentHtml += '      <input type="checkbox" class="custom-control-input" id="children'+index+'" name="studentBro" checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'" disabled>';
								studentHtml += '      <label class="custom-control-label" for="children'+index+'">'+item.studentName;
								studentHtml += '    <span class="badge-list">'+commonMessage('CU_0023_02')+'</span>';
							}else{
								studentHtml += '      <input type="checkbox" class="custom-control-input" id="children'+index+'"  name="studentBro"  checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'">';
								studentHtml += '      <label class="custom-control-label" for="children'+index+'">'+item.studentName ;
							}
							studentHtml += '      <span class="desc">('+item.studentId+'/'+makeStudentGradeByCode(item.grade)+')</span></label>';
							studentHtml += '    </div>';
							studentHtml += '</li>';

						});

						$('#studentBroList').append(studentHtml);
						$('#studentBroList input[name="studentBro"]').prop('checked', false);
						setLanguage('#studentInfo');

						$('#next12').addClass('disabled');
						$('#pay').addClass('disabled');
						$('#selectAll .highlight').text(commonMessage('AD_0025_07', 2 ));
	// 					$('#selectAll .highlight').data('text', 'AD_0025_07');
						setLanguage('#selectAll');
	// 					<span class="right" data-text="AD_0025_08"><span class="highlight" data-text="AD_0025_07">2명</span> 이상 선택</span>
					}else{
						//일반
						$('#title1_1').css('display','');
						$('#title1_1').data('text','AD_0023_01');
						$('#title1_2').css('display','none');

	// 					$('#title1').text('학습할 자녀');
// 						$('#title1').data('text','AD_0023_01');
						$('#studentInfo').css('display', 'block');
						if( resData.product.buyer == 2){
							//학습관 전용 상품 안내
							$('#studentInfo .infoText').css('display','');
						}else{
							$('#studentInfo .infoText').css('display','none');
						}
						$('#studentBroInfo').css('display', 'none');
						$('#monthInfo').css('display', 'none');

						var studentHtml = "";
						var notSubsCk = -1;
						var stlen = resData.studentList.lenth;
						var sublen = 0;
						var first = 'Y';
						$.each(resData.studentList, function(index, item){
							studentHtml += '<li>';
							studentHtml += '    <div class="custom-control custom-radio custom-control-inline">';

							/*

							//TODO
							divCd, statusCd 관련 퍼블 적용하기
							-체험회원은 무료 상품만 이용 가능합니다. + 딤
							-AI형 학습기로 변경 후 학습 가능합니다. + 딤
							*/



							//학습중
							if(item.subscribeYn == "Y"){
								studentHtml += '    <input type="radio" name="name" id="children'+index+'" class="custom-control-input line" checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'" disabled>';
								studentHtml += '    <label class="custom-control-label" for="children'+index+'">'+item.studentName;
								studentHtml += '    <span class="badge-list">'+commonMessage('CU_0023_02')+'</span>';
								sublen ++;
							}else{

								if( item.useYn == '1' ||  item.useYn == 'Y' ){
									studentHtml += '    <input type="radio" name="name" id="children'+index+'" class="custom-control-input line" checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'">';
									studentHtml += '    <label class="custom-control-label" for="children'+index+'">'+item.studentName;

									if( first == 'Y'){
										console.log('notSubsCk> '+notSubsCk);
										notSubsCk = index;
										first = 'N';
									}

								}else{
									studentHtml += '    <input type="radio" name="name" id="children'+index+'" class="custom-control-input line" checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'" disabled>';
									studentHtml += '    <label class="custom-control-label" for="children'+index+'">'+item.studentName +" ("+commonMessage('MY_0012_04')+")";
								}
							}
							studentHtml += '<span class="desc">('+item.studentId+'/'+makeStudentGradeByCode(item.grade)+')</span></label>';
							studentHtml += '    </div>';
							studentHtml += '</li>';

							setLanguage('#children'+index);
						});

						if(stlen > 0 && stlen == sublen){
							$('#next11').addClass('disabled');
						}
						$('#studentList').append(studentHtml);
						console.log('notSubsCk> '+notSubsCk);
						if(notSubsCk > -1){
							$('#children'+notSubsCk+'').prop('checked', true); //학습중인경우 체크 못하게
						}else{
							$('.custom-control-input.line').prop('checked', false); //모두 false
							$('#next11').addClass('disabled');
						}
						$('#selectStudent').text($("input:radio[name=name]:checked").data('selectname'));
						$('#selectStudent').data('text','AD_0025_05');
						setLanguage('#studentInfo');
					}

				}else if(loginType == 1){
					//선생님인 경우
					//20210108 B2B도 학생 추가 후 학생 선택하여 결제 ==> 다계정 상품 처럼 처리

					//다계정 상품의 경우
					$('#title1_1').css('display','');
					$('#title1_1').text(commonMessage('AD_0023_03'));
					$('#title1_1').data('text','AD_0023_03'); //학습할 자녀==> 학습할 학생 선택
					$('#title1_2').css('display','none');

// 					$('#selectText').text(commonMessage('AD_0025_08', data.useAccount));
					$('#studentBroInfo').css('display', 'block');
					$('#studentBroInfo .infoText').hide();//학습관 전용 상품 안내(buyer=2인경우)
					$('#studentInfo').css('display', 'none');
					$('#monthInfo').css('display', 'none');

					var studentHtml = "";
					$.each(resData.studentList, function(index, item){
						studentHtml += '<li>';
						studentHtml += '    <div class="custom-control custom-checkbox custom-control-inline">';
						//학습중
						if(item.subscribeYn == "Y"){
							studentHtml += '      <input type="checkbox" class="custom-control-input" id="children'+index+'" name="studentBro" checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'" disabled>';
							studentHtml += '      <label class="custom-control-label" for="children'+index+'">'+item.studentName;
							studentHtml += '    <span class="badge-list">'+commonMessage('CU_0023_02')+'</span>';
						}else{

							if( item.useYn == '1'  ||  item.useYn == 'Y' ){
								studentHtml += '      <input type="checkbox" class="custom-control-input" id="children'+index+'"  name="studentBro"  checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'">';
								studentHtml += '      <label class="custom-control-label" for="children'+index+'">'+item.studentName;
							}else{//isUseParent
								studentHtml += '      <input type="checkbox" class="custom-control-input" id="children'+index+'"  name="studentBro"  checked="" data-selectname="'+item.studentName+'" data-selectid="'+item.studentSid+'" disabled>';
								studentHtml += '      <label class="custom-control-label" for="children'+index+'">'+item.studentName +" ("+commonMessage('MY_0012_04')+")";
							}
						}
						studentHtml += '      <span class="desc">('+item.studentId+'/'+makeStudentGradeByCode(item.grade)+')</span></label>';
						studentHtml += '    </div>';
						studentHtml += '</li>';

					});

					$('#studentBroList').append(studentHtml);
					$('#studentBroList input[name="studentBro"]').prop('checked', false);
					setLanguage('#studentInfo');

					$('#next12').addClass('disabled');
					$('#pay').addClass('disabled');
					$('#selectAll .highlight').text(commonMessage('AD_0025_07', 2 ));
// 					$('#selectAll .highlight').data('text', 'AD_0025_07');
					setLanguage('#selectAll');

					//체크 학생수 만큼 개수++
					$('#selectStudent').data('text','AD_0026_02;'+$('#qty').val());

					/* 20210108 이전 소스
	// 				$('#title1').text('수량');
	// 				$('#title1').data('text','AD_0026_01');
					$('#title1_1').css('display','none');
					$('#title1_2').css('display','');

					$('#studentInfo').css('display', 'none');
					$('#studentBroInfo').css('display', 'none');
					$('#monthInfo').css('display', 'block');
					$('#selectStudent').html($('#qty').val()+'<em>'+commonMessage('AD_0026_02')+'</em>');
	// 				$('#selectStudent').data('text','AD_0026_02;'+$('#qty').val());
					setLanguage('#selectStudent');


					*/

					//기존소스
					 if(resData.product.saleType == '3' || resData.product.price == '0'){//무료
							$('#pay').text('이용하기');
							$('#payOptionName').data('text', '');
							$('#monthPrice').html('<em class="font-weight-bold" >'+commonMessage('AD_0034_18')+'</em>');
							$('#monthPrice').data('price', resData.product.price*$('#discountPercent').val());
					 }else{
						//0:약정
						if(resData.product.saleType == '0'){
	// 						$('payOptionName').text('월별 결제');
							$('#payOptionName').data('text', 'CU_0028_01');
							$('#monthPrice').html('<em class="font-weight-bold">￦'+commaNum(resData.product.price*1*$('#qty').val()*$('#discountPercent').val())+'</em> / <em>'+commonMessage('CU_0029_07')+'</em>');
							$('#monthPrice').data('price', resData.product.price*$('#discountPercent').val());
						//1:무제한 정기
						}else if(resData.product.saleType == '1'){
	// 						$('payOptionName').text('월별 결제');
							$('#payOptionName').data('text', 'CU_0028_01');
							$('#monthPrice').html('<em class="font-weight-bold">￦'+commaNum(resData.product.price*1*$('#qty').val()*$('#discountPercent').val())+'</em> / <em>'+commonMessage('CU_0029_07')+'</em>');
							$('#monthPrice').data('price', resData.product.price*$('#discountPercent').val());
						}else if(resData.product.saleType == '2'){
							//1회결제
	// 						$('payOptionName').text('총 결제 금액');
							$('#payOptionName').data('text', 'AD_0033_01');
							$('#monthPrice').html('<em class="font-weight-bold">￦'+commaNum(resData.product.price*1*$('#qty').val()*$('#discountPercent').val())+'</em>');
							$('#monthPrice').data('price', resData.product.price*$('#discountPercent').val());
						}
					 }
				}else{

					return;
				}

				setLanguage('#monthPrice');

			}else{
				//학생이 없는 경우
				//20210108 B2B도 학생 추가 후 결제
// 				if(loginType == '0' || loginType == '2'){

					var option  = { title : "", btnOk : "확인" };
					commonAlert('MY_0013_01', option, window.history.back() );
// 				}

			}

		}

		//페이지 다시 불러오는 경우 자동 체크
		if($('#list1').prop('checked') && $('#list2').prop('checked')){
			$('#selectAgree').text(commonMessage('AD_0033_10'));
			if($('#isDelivery').val() == "0"){
				$('#pay').removeClass('disabled');
			}else if(inputCheck){//주소지 정보도 정상이면
				$('#pay').removeClass('disabled');
			}

		}
	}else{

		var message = commonMessage("AD_0006_12");
		var title = commonMessage("AD_0006_11");
		commonAlert(message, {title : title}, function(){
			location.replace("/webapp/html/main/main.html");
		});
	}


	//학생 체크값 다시 설정시
	var chkStudent = sessionStorage.getItem('chkStudent');
	if(!$.isEmpty(chkStudent)){


		//다자녀 다중 선택 기능 없음 20210426
		if(productBroYn == "Y"){
			var chkidArr = chkStudent.split(",");
			var idx = 0;
			chkidArr.forEach(function(i){
				$('#studentBroList input[name="studentBro"]').each(function (j, elements) {
					if($(this).data('selectid') == i){
						$(this).prop('checked', true);
						idx++;
					}
			 	});
			});

			//console.log('data.useAccount:'+ data.useAccount);
			if(idx >= 2 && idx <= data.useAccount){
				$('#next12').removeClass('disabled');
			}

		}else{
			$('#studentList input[name=name]').each(function(i, elements){
				if($(this).data('selectid') == chkStudent){
					$(this).prop('checked', true);
				}
			})
		}

		sessionStorage.removeItem('chkStudent');
	}

	//주소값 세팅
	inputCheck = sessionStorage.getItem('inputCheck');
	if(!$.isEmpty(inputCheck) && !$.isEmpty($('#address2').val())){
		$('#next2').removeClass('disabled');
		$('#selectAddress').text($('#address2').val());
		inputCheck = true;
	}


	//폰번호1 세팅
	var phone1 = sessionStorage.getItem('phone1');
	if(!$.isEmpty(phone1)){
		$('#phone').val(phone1);
	}
	sessionStorage.removeItem('phone1');

	//약관 체크 세팅
	var list1 = nvl(sessionStorage.getItem('list1'),'false');

	if(list1  == 'true'){
		$('#list1').prop('checked',true);
	}else{
		$('#list1').prop('checked',false);
	}
	sessionStorage.removeItem('list1');

	var list2 = nvl(sessionStorage.getItem('list2'),'false');
	if(list2  == 'true'){
		$('#list2').prop('checked',true);
	}else{
		$('#list2').prop('checked',false);
	}
	sessionStorage.removeItem('list2');


	inputMandCheck();

}

//말일 체크
function addMonth(date, month) {
  // month달 후의 1일
  let addMonthFirstDate = new Date(
    date.getFullYear(),
    date.getMonth() + month,
    1
  );

  // month달 후의 말일
  let addMonthLastDate = new Date(
    addMonthFirstDate.getFullYear(),
    addMonthFirstDate.getMonth() + 1
    , 0
  );

  let result = addMonthFirstDate;
  if(date.getDate() > addMonthLastDate.getDate())
  {
    result.setDate(addMonthLastDate.getDate());
  }
  else
  {
    result.setDate(date.getDate());
  }

  return result;
}

function pay(){


	showLoadingbar();


	//단말체크 정보로 판단
	var mobileYn = "N";

	if(Global.reqCommonData.devinfo == 'MOBILE'){
		mobileYn = 'Y';
	}
	//모바일 웹일때도 모바일 결제 화면
// 	if($( window ).width() < 1024){
// 		mobileYn = 'Y';
// 	}

	var email = $('#email').val()+'@'+$('#domain').val();
	if($('#email').val() != ''){
		if(!validateEmail(email)){
			return;
		}
	}else{
		email = '';
	}

	var form = $('<form></form>');
	form.attr('method','post');

	if(testerYn == "Y" && testProdYn == "Y"){
		//테스터의 테스트 상품의 경우 무료로 전달
		form.attr('action','/marketplace/payment/free');
	}else{

		if($('#saleType').val() == 0 || $('#saleType').val() == 1){
			//정기결제
			form.attr('action','/marketplace/payment/auth');
		}else if($('#saleType').val() == 3){
			//무료
			form.attr('action','/marketplace/payment/free');
		}else{
			//1회성결제
			form.attr('action','/marketplace/payment/index');
		}
	}

    form.appendTo('body');
    var saleProductCode = $("<input type='hidden' value='"+$.getUrlParam("saleProductCode")+"' name='saleProductCode'>");
    var productName = $("<input type='hidden' value='"+$('#title').val()+"' name='productName'>");
    //모바일결제 여부
    var isMobile = $("<input type='hidden' value='"+mobileYn+"' name='isMobile'>");
    //판매유형 0:약정정기결제 1:무제한정기결제 2:1회성결제
    var saleType = $("<input type='hidden' value='"+$('#saleType').val()+"' name='saleType'>");
    //수량*할인만 계산된 가격
    var price = $("<input type='hidden' value='"+($('#basePrice').val())+"' name='price'>");
    var contractMonth = $("<input type='hidden' value='"+$('#contractMonth').val()+"' name='contractMonth'>");
    var amount = $("<input type='hidden' value='"+$('#qty').val()+"' name='amount'>");
    var address1 = $("<input type='hidden' value='"+$('#address1').val()+"' name='address1'>");
    var address2 = $("<input type='hidden' value='"+$('#address2').val()+"' name='address2'>");
    var address3 = $("<input type='hidden' value='"+$('#address3').val()+"' name='address3'>");
    var phone = $("<input type='hidden' value='"+$('#phone').val()+$('#phone_m').val()+$('#phone_l').val()+"' name='phone'>");
    var phone2 = $("<input type='hidden' value='"+$('#phone2').val()+$('#phone2_m').val()+$('#phone2_l').val()+"' name='phone2'>");
    var email = $("<input type='hidden' value='"+email+"' name='email'>");
    var memo = $("<input type='hidden' value='"+$('#memo').val()+"' name='memo'>");
    var rName = $("<input type='hidden' value='"+$('#rName').val()+"' name='rName'>");
    var orderNumber = $("<input type='hidden' value='' name='orderNumber'>");
    var billingBeginDate = $("<input type='hidden' value='"+ $('#billingBeginDate').val()+"' name='billingBeginDate'>");
    var billingEndDate = $("<input type='hidden' value='"+ $('#billingEndDate').val()+"' name='billingEndDate'>");

    var memberSid = $("<input type='hidden' value='"+ Global.reqCommonData.memberSid+"' name='memberSid'>");
    var memberType = $("<input type='hidden' value='"+ Global.reqCommonData.memberType+"' name='memberType'>");
    var memberName = $("<input type='hidden' value='"+ Global.reqCommonData.memberName+"' name='memberName'>");
    var memberToken = $("<input type='hidden' value='"+ Global.reqCommonData.userToken+"' name='userToken'>");
    var lang = $("<input type='hidden' value='"+ Global.reqCommonData.countryCode+"' name='lang'>");

    var selectid = "";
    if(productBroYn == "Y" || loginType == 1){//학생 다중 선택인 경우//다자녀 다중 선택 기능 없음 20210426
    	$('#studentBroList input[name="studentBro"]:checked').each(function (i, elements) {
    		if(i == 0){
	    		selectid += $(elements).data('selectid');
    		}else{
	    		selectid += ','+$(elements).data('selectid');
    		}
    	});
    }else{
    	selectid = $("input:radio[name=name]:checked").data('selectid');
    }

    var studentSid = $("<input type='hidden' value='"+selectid+"' name='studentSid'>");

    form.append(saleProductCode);
    form.append(productName);
    form.append(isMobile);
    form.append(saleType);
    form.append(price);
    form.append(contractMonth);
    form.append(amount);
    form.append(address1);
    form.append(address2);
    form.append(address3);
    form.append(phone);
    form.append(phone2);
    form.append(email);
    form.append(memo);
    form.append(rName);
    form.append(orderNumber);
    form.append(studentSid);
    form.append(billingBeginDate);
    form.append(billingEndDate);
    //로그인 정보 전달(ajax header 대신)
    form.append(memberSid);
    form.append(memberType);
    form.append(memberName);
    form.append(memberToken);
    form.append(lang);

    //로딩바 열기
	showLoadingbar();

    //결제시 saleproductcode session에 저장
    sessionStorage.setItem('spc', $.getUrlParam("saleProductCode"));

    form.submit();

// 		model.addObject("buyr_name","");

}


function makePadZero(num){
	if(parseInt(num) < 10) {
		num = "0" + num;
	}
	return num;
}



var fnUserInfo = function(){
	if(loginSid == null){
		//로그아웃상태 진입 금지
		commonAlert('CU_0002_04');
		goProductDetail();
		return;
	}else if($.isEmpty(loginType)){
		//학생일때 진입 금지
		goProductDetail();
		return;
	}

}

function makeStudentGradeByAge(age){
	var text = '';

	if(age >= 8 && age <= 13){
		text = '초'+(age*1-7);
	}else if(age <= 16){
		text = '중'+(age*1-13);
	}else if(age > 16){
		text = '고'+(age*1-16);
	}else{
		text+='세';
	}
	return text;
}

//코드로 학년 변환
function makeStudentGradeByCode(code){
	var text = '';
	if(code >= -2 && code <= 0){
		text = '예비'; //code*1+7//5, 6, 7
	}else if(code <= 6){
		text = '초'+code;
	}else if(code <= 9){
		text = '중'+(code*1-6);
	}else if(code > 10){
		text = '고'+(code*1-9);
	}
	return text;
}



//우편번호 찾기
$("#getDaumPostcode").on("click", function(e){
	onClickEventPrevent(e);
	// 현재 scroll 위치를 저장해놓는다.
	var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
	openModalPopup("postcodePopup", "/webapp/html/common/popup/postcode.html", "tag-notice-setting", "", function(data){

		var userLang = sessionStorage.getItem('lang') == null? 'ko' :sessionStorage.getItem('lang');

		if(!$.isEmpty(data)){

			var addr = ''; // 주소 변수
			var extraAddr = ''; // 참고항목 변수
			//사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
			if(data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
				if(userLang == 'en'){
					addr = data.roadAddressEnglish;
				}else{
					addr = data.roadAddress;
				}
			}
			else { // 사용자가 지번 주소를 선택했을 경우(J)
				if(userLang == 'en'){
					addr = data.jibunAddressEnglish	;
				}else{
					addr = data.jibunAddress;
				}
			}
// 			console.log(data.roadAddressEnglish);

			$('#address1').val(data.zonecode);
			$('#address2').val(addr);
			$('#address3').focus();

			// 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
// 			if(data.userSelectedType === 'R') {
				// 법정동명이 있을 경우 추가한다. (법정리는 제외)
				// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
				if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
					extraAddr += data.bname;
				}
				// 건물명이 있고, 공동주택일 경우 추가한다.
				if(data.buildingName !== '' && data.apartment === 'Y') {
					extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
				}
				// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
				if(extraAddr !== '') {
					extraAddr = ' (' + extraAddr + ')';
				}
				// 조합된 참고항목을 해당 필드에 넣는다.
				$("#address2").val($("#address2").val() + extraAddr);
				$('#selectAddress').text($('#address2').val());
// 			}
// 			else {
// 				$("#address2").val('')
// 			}

			// iframe을 넣은 element를 안보이게 한다.
			// (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
			$('#zipcodeModal').modal('hide');
			// 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
			document.body.scrollTop = currentScroll;
		}
	});
});


var goProductDetail = function(){
	goProducctDetailPage(saleProductCode);
// 	location.href = '/webapp/html/product/detail.html?saleProductCode='+saleProductCode;
}



var goTerms = function(type){
	location.href = '/webapp/html/common/termsofuse.html?termsType='+type;
}
</script>

</body>


</html>
