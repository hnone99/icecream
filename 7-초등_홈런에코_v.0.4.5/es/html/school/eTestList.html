<!DOCTYPE html>
<html lang="ko">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="Referrer" content="origin" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  <meta name="viewport" content="width=1280, user-scalable=no" />
  <meta name="apple-mobile-web-app-title" content="Home Learn Hybrid" />
  <meta name="robots" content="index,nofollow" />
  <meta name="description" content="Home Learn Hybrid" />
  <meta name="keywords" content="Home Learn Hybrid" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>평가학습</title>
  <link rel="stylesheet" href="/es/css/bootstrap.css">
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@1.0/nanumsquare.css">
  <script src="/es/js/init.js"></script>
  <style>
      /*현재 페이지 스크롤바 안보이게 */
    .scroll{-ms-overflow-style: none;}
    .scroll::-webkit-scrollbar {display:none;}
  </style>

  <script type="text/javascript">
    const SUBJ_TAB_LIST = [
      {
        subj_nm: "요점노트",
        subj_tab: "tab_1",
        subj_css: "testStudy"
      },
      {
        subj_nm: "실력평가",
        subj_tab: "tab_2",
        subj_css: "testStudy"
      },
      {
        subj_nm: "스피드퀴즈",
        subj_tab: "tab_3",
        subj_css: "testStudy"
      },
      {
        subj_nm: "단원평가",
        subj_tab: "tab_4",
        subj_css: "testStudy"
      },
      {
        subj_nm: "서술형평가",
        subj_tab: "tab_5",
        subj_css: "testStudy"
      }
    ];

    const SUBJ_LIST_BY_GRADE = {
      "1": {
          "1": {
            "요점노트": ["국어", "수학", "통합"],
            "실력평가": ["국어", "수학"],
            "단원평가": ["국어", "수학", "통합"],
            "서술형평가": ["국어", "수학", "통합"]
          },
          "2": {
            "요점노트": ["국어", "수학", "통합"],
            "실력평가": ["국어", "수학"],
            "단원평가": ["국어", "수학", "통합"],
            "서술형평가": ["국어", "수학", "통합"]
          }
        },
        "2": {
          "1": {
            "요점노트": ["국어", "수학", "통합"],
            "실력평가": ["국어", "수학"],
            "단원평가": ["국어", "수학", "통합"],
            "서술형평가": ["국어", "수학", "통합"]
          },
          "2": {
            "요점노트": ["국어", "수학", "통합"],
            "실력평가": ["국어", "수학"],
            "단원평가": ["국어", "수학", "통합"],
            "서술형평가": ["국어", "수학", "통합"]
          }
        },
        "3": {
          "1": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          },
          "2": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          }
        },
        "4": {
          "1": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          },
          "2": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          }
        },
        "5": {
          "1": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          },
          "2": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          }
        },
        "6": {
          "1": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          },
          "2": {
            "요점노트": ["국어", "수학", "사회", "과학", "영어"],
            "실력평가": ["국어", "수학", "사회", "과학", "영어"],
            "스피드퀴즈": ["국어", "수학", "사회", "과학", "영어"],
            "단원평가": ["국어", "수학", "사회", "과학", "영어"],
            "서술형평가": ["국어", "수학", "사회", "과학"]
          }
        }
      };

    let PAGE_TITLE = $("title").text();
    let REQ_SUB_SUBJ = null; //하위 교과서
    let REQ_ENG_SUBJ = null; //영어 하위 교과서
    let REQ_SUBJ = fnGetParam("subj");//현재 선택된 메뉴
    let REQ_TAB = fnGetParam("tab");//현재 선택된 tab
    let REQ_GRADE = fnGetParam("grade");//현재 선택된 학년
    let REQ_TERM = fnGetParam("term");//현재 선택된 학기
    let REQ_BOOKNAME = fnGetParam("bookname") // 영어과목일 경우 선택된 교과서명 (영어 과목 아닐 경우 무시)
    let REQ_SUBJ_VNM = null;//현재선택된 교과 노출명
    let REQ_PRESUBJ_NM = null;//현재선택된 과목내용

    let CUR_LIST = null;//현재 선택된 컨텐츠 목록

    if (REQ_SUBJ == null || REQ_SUBJ == "") {

      if (REQ_TAB == null || REQ_TAB == "") {

        REQ_TAB = "tab_1";
      }

      REQ_SUBJ = fnGetTabName(REQ_TAB);
    }
    else if (REQ_TAB == null || REQ_TAB == "") {

      REQ_TAB = fnGetTabID(REQ_SUBJ);
    }

    let SUBJ_LIST = new Array();// 조회한 학년학기별 과목 목록 데이터

    function backKeyEvent() {

      fnCloseWebView();
    }
    //종료 팝업 메시지 출력
    function fnCloseWebView() {

      //commonConfirm("학교공부평가을(를) 종료하시겠습니까?", '', closeWebView, '');
      commonConfirm("평가학습을(를) 종료하시겠습니까?", '', closeWebView, '');
    }

    function fnOnLoaded(){
      //닫기버튼 이벤트 설정
      $('#closeBtnID').on("click", fnCloseWebView);

      fnGetTop();
      $('.menu_top > ul > li').each(function (index, item) {

        $(item).on('click', function () {

          var selGradValue = $('#topGradeViewID').attr("data-value");
          var grade = Math.round(selGradValue / 2);
          var term = (selGradValue % 2 == 0 ? 2 : 1);

          REQ_SUBJ = fnGetTabName(this.id);

          //조회 성공 후 메뉴 변경
          fnSetGradeTerm(REQ_GRADE, REQ_TERM);
          fnGetSubSubjList(REQ_GRADE, REQ_TERM);
          fnSetTabMenu(REQ_SUBJ, REQ_GRADE, REQ_TERM);

          // URL 변경
          fnChangeURL({subj: REQ_SUBJ});
        });
      });

      // 학년/학기 dropdown 메뉴 선택시 URL 변경
      $(".customSelect li, .customSelect2 li, .custom_select li").on("click", function(evt) {
    	  var selValue = $(this).attr("data-value");
    	  var grade = Math.round(selValue / 2);
    	  var term = (selValue % 2 == 0 ? 2 : 1);

    	  fnChangeURL({
    		grade: grade,
    		term: term
    	  });
      })
    }

    //과목,학년 목록 조회
    function fnGetTop() {

      var param = {
        term_cd: REQ_TERM,
        grade_div: REQ_GRADE
      };
      $.postJSON('hapi', '/schooltest/ExamTabList', null, fnGetTopOk, false);
    }

    //과목,학년 목록 Object 생성
    function fnGetTopOk(retData) {

      if (retData.resultCode == 0) {

        var list = retData.examTabList;
        // console.log("================================= before sort ==================================== ");
        // console.log(JSON.stringify(list));
        // console.log("================================= before sort ==================================== ");

        //과목, 학년, 학기로 정렬
        list.sort(fnExamTestSort);
        // console.log("================================= after sort ==================================== ");
        // console.log(JSON.stringify(list));
        // console.log("================================= after sort ==================================== ");

        var topInfoIdx = 0;
        var topInfoFlag = false;
        var gvalue = 0;//학년학기선택 항목 설정 값

        console.log("all list : " + list.length);
        if (list != null && list.length > 0) {

          var tabstrList = JSON.stringify(SUBJ_TAB_LIST);
          for (var l = list.length - 1; l >= 0; l--) {

            //console.log("Exam : " + list[l].code_dtl_nm);

            if (tabstrList.indexOf(list[l].code_dtl_nm) < 0)
              list.splice(l, 1);
            //else
            //console.log("View Exam : " + list[l].code_dtl_nm);
          }
          //console.log("filtered list : " + list.length);

          var subjList = null;
          for (var l = 0; l < list.length; l++) {

            topInfoFlag = false;
            for (var t = 0; t < SUBJ_LIST.length; t++) {

              if (SUBJ_LIST[t].grade == list[l].grade_div && SUBJ_LIST[t].term == list[l].term_cd) {
                topInfoFlag = true;
                break;
              }
            }

            if (l == 0 || !topInfoFlag)
              SUBJ_LIST[topInfoIdx++] = { grade: list[l].grade_div, term: list[l].term_cd, subjList: new Array() };

            //console.log("grade: "+ list[l].grade_div+", term: "+list[l].term_cd+", list["+l+"].code_dtl_nm :: " + list[l].code_dtl_nm + ", list[" + l + "].exam_div :: " + list[l].exam_div);
            SUBJ_LIST[topInfoIdx - 1].subjList.push({
              subj_nm: list[l].code_dtl_nm,
              code_dtl_nm: list[l].code_dtl_nm,
              exam_div: list[l].exam_div
            });
          }
          //console.log(JSON.stringify(SUBJ_LIST));
          //교과 목록 조회 후 컨텐츠 목록 조회
          fnSetGradeTerm(REQ_GRADE, REQ_TERM);
          fnGetSubSubjList(REQ_GRADE, REQ_TERM);
          fnSetTabMenu(REQ_SUBJ, REQ_GRADE, REQ_TERM);
        }
      }
      else {

        alert("error");
      }
    }

    //하위 과목 목록 조회
    function fnGetSubSubjList(REQ_GRADE, REQ_TERM) {

      /* console.log("fnGetSubSubjList.REQ_SUBJ : " + REQ_SUBJ);
      console.log("fnGetSubSubjList.REQ_TAB : " + REQ_TAB);
      console.log("fnGetSubSubjList.REQ_GRADE : " + REQ_GRADE);
      console.log("fnGetSubSubjList.REQ_TERM : " + REQ_TERM);
      console.log("fnGetSubSubjList.REQ_PRESUBJ_NM : " + REQ_PRESUBJ_NM); */

      if ("요점노트".indexOf(REQ_SUBJ) > -1) {

        $.postJSON('eco', '/schooltest/NewPointNoteGradeTermSubjList', { code_gbn: 10006 }, fnGetSubSubjListOk1, false);
      }
      else {

        $.postJSON('eco', '/schooltest/NewGradeTermSubjList', null, fnGetSubSubjListOk2, false);
      }
    }

    //요점노트 과목 목록 설정
    function fnGetSubSubjListOk1(retData) {

      if (retData.resultCode == "0") {

        var list = retData.pointNoteSubjList;
        list.sort(fnSchoolStudySort);
        if (list != null && list.length > 0) {

          var aIdx = -1;

          //이전 선택 과목이 현재 목록에 없는 경우 확인
          for (var n = 0; n < list.length; n++) {

            if ((ECO_MENUS && ECO_MENUS.length > 0 && !ECO_MENUS.includes(list[n].pre_subj_viw_nm))
              || list[n].grade_div != REQ_GRADE
              || list[n].term_cd != REQ_TERM)
              continue;

            if (REQ_PRESUBJ_NM != null && REQ_PRESUBJ_NM != "" && list[n].pre_subj_viw_nm == REQ_PRESUBJ_NM) {

              aIdx = n;
              break;
            }
          }
          var idx = 0;
          var liClass = "";
          var icClass = "";
          REQ_ENG_SUBJ = null;//영어 하위 교과서
          REQ_SUB_SUBJ = { html: "", params: new Array() };

          REQ_SUB_SUBJ.html += '<div id="subjLstID" class="cMenu active _cMenu">';
          REQ_SUB_SUBJ.html += '<ul>';
          for (var n = 0; n < list.length; n++) {

            /*console.log("list[n].subj_viw_nm : " + list[n].subj_viw_nm);
            console.log("list[n].grade_div : " + list[n].grade_div);
            console.log("list[n].term_cd : " + list[n].term_cd);*/
            //구매한 메뉴에 없는 과목의 경우 스킵
            if ((ECO_MENUS && ECO_MENUS.length > 0 && !ECO_MENUS.includes(list[n].pre_subj_viw_nm))
              || list[n].grade_div != REQ_GRADE
              || list[n].term_cd != REQ_TERM)
              continue;

            if (list[n].pre_subj_viw_nm == "국어") {

              liClass = "kor";
              icClass = "kor";
            }
            else if (list[n].pre_subj_viw_nm == "수학") {

              liClass = "math";
              icClass = "math";
            }
            else if (list[n].pre_subj_viw_nm == "사회") {

              liClass = "society";
              icClass = "society";
            }
            else if (list[n].pre_subj_viw_nm == "과학") {

              liClass = "science";
              icClass = "science";
            }
            else if (list[n].pre_subj_viw_nm == "영어") {

              liClass = "english";
              icClass = "eng";
            }
            else if (list[n].pre_subj_viw_nm == "통합") {

              liClass = "combine";
              icClass = "combine";
            }

            if (list[n].pre_subj_viw_nm == "영어" || ECO_CURRENT_MENU == null) {
              if (aIdx < 0 || aIdx == n) {

                ECO_CURRENT_MENU = null;
                liClass += " active";
                aIdx = idx;
              }
            }
            else {

              if (ECO_CURRENT_MENU == list[n].pre_subj_viw_nm) {

                ECO_CURRENT_MENU = null;
                liClass += " active";
                aIdx = idx;
              }
            }

            if (list[n].pre_subj_viw_nm != "영어" || REQ_ENG_SUBJ == null) {

              REQ_SUB_SUBJ.html += '<li class="' + liClass + '"><a href="#" data-id="menu' + (++idx) + '" onClick="fnGetList(' + (idx - 1) + ');">';
              REQ_SUB_SUBJ.html += '    <i class="ic-img ic-' + icClass + '"></i>';
              REQ_SUB_SUBJ.html += '    <span class="tit">' + list[n].pre_subj_viw_nm + '</span></a>';
              REQ_SUB_SUBJ.html += '</li>';
              REQ_SUB_SUBJ.params.push(list[n]);
            }

            if (list[n].pre_subj_viw_nm == "영어") {

              if (REQ_ENG_SUBJ == null) {

                REQ_ENG_SUBJ = { html: "", params: new Array() };

                REQ_ENG_SUBJ.html += '<div id="engSubjLstID" class="cCategory _cCategory">';
                REQ_ENG_SUBJ.html += '  <ul>';
                REQ_ENG_SUBJ.html += '    <li class="active" data-id="category1">';
              }
              else {

                REQ_ENG_SUBJ.html += '    <li data-id="category' + (REQ_ENG_SUBJ.params.length + 1) + '">';
              }
              // 영어교과서 목록 그리기
              //console.log("REQ_ENG_SUBJ.params.length ==== " + REQ_ENG_SUBJ.params.length);
              REQ_ENG_SUBJ.html += '<a href="#" onClick="fnGetEngList(' + REQ_ENG_SUBJ.params.length + ');">' + list[n].subj_viw_nm + '</a></li>';

              REQ_ENG_SUBJ.params.push(list[n]);
            }
          }
          REQ_SUB_SUBJ.html += '</ul>';
          REQ_SUB_SUBJ.html += '</div >';

          $('#leftGroupID').html(REQ_SUB_SUBJ.html);

          if (REQ_ENG_SUBJ != null) {

            REQ_ENG_SUBJ.html += '  </ul>';
            REQ_ENG_SUBJ.html += '</div >';
            //$('#leftGroupID').append(REQ_ENG_SUBJ.html);
          }
          fnGetList(aIdx);
        }
      }
    }

    //요점노트 외 과목 목록 설정
    function fnGetSubSubjListOk2(retData) {

      if (retData.resultCode == "0") {

        var list = retData.subjList;
        list.sort(fnSchoolStudySort);
        if (list != null && list.length > 0) {

          var aIdx = -1;

          //이전 선택 과목이 현재 목록에 없는 경우 확인
          for (var n = 0; n < list.length; n++) {

            if ((ECO_MENUS && ECO_MENUS.length > 0 && !ECO_MENUS.includes(list[n].pre_subj_viw_nm))
              || list[n].exam_nm != REQ_SUBJ //메뉴명 필터
              || list[n].grade_div != REQ_GRADE
              || list[n].term_cd != REQ_TERM)
              continue;

            if (REQ_PRESUBJ_NM != null && REQ_PRESUBJ_NM != "" && list[n].pre_subj_viw_nm == REQ_PRESUBJ_NM) {

              aIdx = n;
              break;
            }
          }
          var idx = 0;
          var liClass = "";
          var icClass = "";
          REQ_ENG_SUBJ = null;//영어 하위 교과서
          REQ_SUB_SUBJ = { html: "", params: new Array() };

          REQ_SUB_SUBJ.html += '<div id="subjLstID" class="cMenu active _cMenu">';
          REQ_SUB_SUBJ.html += '<ul>';
          for (var n = 0; n < list.length; n++) {

            /*console.log("list[n].subj_viw_nm : " + list[n].subj_viw_nm);
            console.log("list[n].grade_div : " + list[n].grade_div);
            console.log("list[n].term_cd : " + list[n].term_cd);*/
            //구매한 메뉴에 없는 과목의 경우 스킵
            if ((ECO_MENUS && ECO_MENUS.length > 0 && !ECO_MENUS.includes(list[n].pre_subj_viw_nm))
              || list[n].exam_nm != REQ_SUBJ //메뉴명 필터
              || list[n].grade_div != REQ_GRADE
              || list[n].term_cd != REQ_TERM)
              continue;

            if (list[n].pre_subj_viw_nm == "국어") {

              liClass = "kor";
              icClass = "kor";
            }
            else if (list[n].pre_subj_viw_nm == "수학") {

              liClass = "math";
              icClass = "math";
            }
            else if (list[n].pre_subj_viw_nm == "사회") {

              liClass = "society";
              icClass = "society";
            }
            else if (list[n].pre_subj_viw_nm == "과학") {

              liClass = "science";
              icClass = "science";
            }
            else if (list[n].pre_subj_viw_nm == "영어") {

              liClass = "english";
              icClass = "eng";
            }
            else if (list[n].pre_subj_viw_nm == "통합") {

              liClass = "combine";
              icClass = "combine";
            }


            if (list[n].pre_subj_viw_nm == "영어" || ECO_CURRENT_MENU == null) {
              if (aIdx < 0 || aIdx == n) {

                ECO_CURRENT_MENU = null;
                liClass += " active";
                aIdx = idx;
              }
            }
            else {

              if (ECO_CURRENT_MENU == list[n].pre_subj_viw_nm) {

                ECO_CURRENT_MENU = null;
                liClass += " active";
                aIdx = idx;
              }
            }

            if (list[n].pre_subj_viw_nm != "영어" || REQ_ENG_SUBJ == null) {

              REQ_SUB_SUBJ.html += '<li class="' + liClass + '"><a href="#" data-id="menu' + (++idx) + '" onClick="fnGetList(' + (idx - 1) + ');">';
              REQ_SUB_SUBJ.html += '    <i class="ic-img ic-' + icClass + '"></i>';
              REQ_SUB_SUBJ.html += '    <span class="tit">' + list[n].pre_subj_viw_nm + '</span></a>';
              REQ_SUB_SUBJ.html += '</li>';
              REQ_SUB_SUBJ.params.push(list[n]);
            }

            if (list[n].pre_subj_viw_nm == "영어") {

              if (REQ_ENG_SUBJ == null) {

                REQ_ENG_SUBJ = { html: "", params: new Array() };

                REQ_ENG_SUBJ.html += '<div id="engSubjLstID" class="cCategory _cCategory">';
                REQ_ENG_SUBJ.html += '  <ul>';
                REQ_ENG_SUBJ.html += '    <li class="active" data-id="category1">';
              }
              else {

                REQ_ENG_SUBJ.html += '    <li data-id="category' + (REQ_ENG_SUBJ.params.length + 1) + '">';
              }
              //console.log("REQ_ENG_SUBJ.params.length ==== " + REQ_ENG_SUBJ.params.length);
              REQ_ENG_SUBJ.html += '<a href="#" onClick="fnGetEngList(' + REQ_ENG_SUBJ.params.length + ');">' + list[n].subj_viw_nm + '</a></li>';

              REQ_ENG_SUBJ.params.push(list[n]);
            }
          }
          REQ_SUB_SUBJ.html += '</ul>';
          REQ_SUB_SUBJ.html += '</div >';

          $('#leftGroupID').html(REQ_SUB_SUBJ.html);

          if (REQ_ENG_SUBJ != null) {

            REQ_ENG_SUBJ.html += '  </ul>';
            REQ_ENG_SUBJ.html += '</div >';
            //$('#leftGroupID').append(REQ_ENG_SUBJ.html);
          }
          fnGetList(aIdx);
        }
      }
    }

    //영어 목록 조회 전용
    function fnGetEngList(idx) {

      var param = REQ_ENG_SUBJ.params[idx];

      if(param) {
          REQ_BOOKNAME = param.subj_viw_nm;
      }

      var OD1 = null;
      OD1 = `${REQ_GRADE}학년 ${REQ_TERM}학기`;

      var OD2 = null;
      if (PAGE_TITLE)
        OD2 = PAGE_TITLE;

      var OD3 = REQ_SUBJ;

      var OD4 = null;
      if (param.subj_viw_nm)
        OD4 = param.pre_subj_nm;

      var OD5 = null;
      if (param.subj_viw_nm)
        OD5= param.subj_viw_nm;

      //xcaliper 적용
      xNaviEvent(OD5, "", `${OD2}>${OD3}>${OD4}>${OD5}`, "M", null, OD1, OD2, OD3, OD4, OD5);
      /*$('#subjLstID a').each(function (){

        $(this).parent().removeClass("active");
      });
      $(obj).parent().addClass("active");*/

      if(param.subj_viw_nm) {
          fnChangeURL({
              bookname: param.subj_viw_nm
          });
      }

      // param에 user_id 추가
      param.user_id = EUSER_INFO.USER_ID;

      return fnGetListRun(param, false);
    }

    function fnGetList() {

    	if( arguments[0] == -1 ){

    		var selGradValue = $('#topGradeViewID').attr("data-value");
            var grade = Math.round(selGradValue / 2);
            var term = (selGradValue % 2 == 0 ? 2 : 1);

			if(grade < 3 ){

         	   REQ_SUBJ = fnGetTabName(this.id);

         	   REQ_GRADE = grade;
        	    REQ_TERM = term;
          	  //조회 성공 후 메뉴 변경

          	  // 20220110 ynjoung added.
          	  // 지원하는 컨텐츠인지 확인
          	  try {
          		  // 선택된 상단 탭
          		  var selectedTabId = $(".menu_top ul li.active").attr("id");
          		  var selectedSubj = SUBJ_TAB_LIST.filter(subj => (subj.subj_tab == selectedTabId));
          		  var selectedSubjNm;
          		  if(selectedSubj) {
          			selectedSubjNm = selectedSubj[0].subj_nm;
          		  }

          		  // 허용된(?) 컨텐츠인지 확인한다
          		  if(
          				SUBJ_LIST_BY_GRADE.hasOwnProperty(REQ_GRADE) &&
          				SUBJ_LIST_BY_GRADE[REQ_GRADE].hasOwnProperty(REQ_TERM)) {

          			// 허용되지 않은 컨텐츠라면...
          			if(!SUBJ_LIST_BY_GRADE[REQ_GRADE][REQ_TERM].hasOwnProperty(selectedSubjNm)) {
          				selectedSubjNm = "요점노트";
          			}
          		  }


          		  // 허용된(?) 과목인지 확인한다
          		  if(
          				SUBJ_LIST_BY_GRADE.hasOwnProperty(REQ_GRADE) &&
          				SUBJ_LIST_BY_GRADE[REQ_GRADE].hasOwnProperty(REQ_TERM) &&
          				SUBJ_LIST_BY_GRADE[REQ_GRADE][REQ_TERM].hasOwnProperty(selectedSubjNm) &&
          				SUBJ_LIST_BY_GRADE[REQ_GRADE][REQ_TERM][selectedSubjNm]) {

          			var subjList = SUBJ_LIST_BY_GRADE[REQ_GRADE][REQ_TERM][selectedSubjNm]

          			// 허용되지 않은 과목이라면...
          			if(!subjList.includes(localStorage.getItem("ECO_CURRENT_MENU"))) {
          				localStorage.setItem("ECO_CURRENT_MENU", subjList[0]);
          			}
          		  }
          	  } catch(e) {
          		  console.error(e);
          	  }

//         	   commonConfirm("현재 학년에서는 지원하지 않습니다. ", null, function () {
	     	       history.pushState(null, '' , '/es/html/school/eTestList.html?subj='+selectedSubjNm+'&grade='+REQ_GRADE+'&term='+REQ_TERM);
	     	       window.location.reload(true);
 //        	     });

    			return;

			}

    	}

      var idx = 0;
      if (arguments == null || arguments.length == 0) {
        console.error("not found parameters!!");
        return false;
      }
      //학년/학기를 선택한 경우 하위 과목을 설정
      // if (arguments.length == 2) {
      if (arguments.length >= 2 && arguments[0] && arguments[1]) {

        REQ_GRADE = arguments[0];
        REQ_TERM = arguments[1];
        fnGetSubSubjList(REQ_GRADE, REQ_TERM);
        return true;
      }
      else
        idx = arguments[0];

      REQ_SUBJ_LIST_IDX = idx;
      var param = REQ_SUB_SUBJ.params[idx];

      // 20210816 ynjoung added.
      // 선택한 과목이 영어라면, 교과서에 맞도록 요청 파라미터를 보정한다
      if(param.pre_subj_nm == "영어" && !$.isEmpty(REQ_BOOKNAME)) {
          var engParam = REQ_ENG_SUBJ.params.filter(function(obj) {
              return (obj.subj_viw_nm == REQ_BOOKNAME);
          });

          if(engParam && engParam.length > 0)
              param = engParam[0];
      } else {
          // 영어를 선택하지 않았다면, 영어 교과서 설정이 초기화될 수 있도록 변수를 초기화한다
          REQ_BOOKNAME = null;
      }

      var OD1 = null;
      OD1 = `${REQ_GRADE}학년 ${REQ_TERM}학기`;

      var OD2 = null;
      if (PAGE_TITLE)
        OD2 = PAGE_TITLE;

      var OD3 = REQ_SUBJ;

      var OD4 = null;
      if (param.pre_subj_nm)
        OD4 = param.pre_subj_nm;

        // 20210621 ynjoung added.
        // 전체메뉴 API를 호출해서, 선택 가능한 학년을 제한한다
        var allMenuParams = {
            user_id: EUSER_INFO.USER_ID,
            isSchoolingUser: ((!$.isEmpty(EUSER_INFO.frontSa)) ? "Y":"N"),
            grade: EUSER_INFO.GRADE_GBN
        };
        $.postJSON('eco', '/eco/api/menu/all', allMenuParams, function(resp) {
            console.trace("menuAll API called");
            if(!resp) {
                console.warn("menuAll API resp: ", resp);
                return;
            }
            if(resp.errorCode != "0000") {
                console.warn("menuAll API resp: ", resp);
                return;
            }

            var gradeList = resp.subjGrade.map(function(grade) { return grade.grade_cd; });
            $("#topGradeID li").each(function(index, el) {
                var jqEl = $(el);
                var value = jqEl.data("value");
                if(!isNaN(value)) {
                    var grade = parseInt(value);
                    grade = Math.round(grade / 2);
                    if(!gradeList.includes("" + grade)) {
                        jqEl.hide();
                    } else {
                        jqEl.show();
                    }
                }
            });
        });

      // param에 user_id 추가
      param.user_id = EUSER_INFO.USER_ID;

      // 세번째 파라미터를 false로 전달했다면, xCaliper 미호출 (두번째 파라미터까지는 위에서 사용)
      if(arguments.length >= 3 && arguments[2] == false) {
      } else {
        //xcaliper 적용
        xNaviEvent(OD4, "", `${OD2}>${OD3}>${OD4}`, "M", null, OD1, OD2, OD3, OD4);
      }
      return fnGetListRun(param, true);
    }

    //학습목록 조회
    function fnGetListRun(param, isNotEng) {

      if (param != null) {

        if (isNotEng) {

          REQ_SUBJ_VNM = param.subj_viw_nm;
          REQ_PRESUBJ_NM = param.pre_subj_nm;
        }

        if ("요점노트".indexOf(REQ_SUBJ) > -1) {

          //{ subj_id: param.subj_id }
          $.postJSON('hapi', '/schooltest/PointNoteLessonList ', param, fnGetListOk, false, null, null, param);
        }
        else if ("스피드퀴즈".indexOf(REQ_SUBJ) > -1) {

          $.postJSON('hapi', '/speed-quiz/list.json', param, fnGetListOk3, false, null, null, param);
        }
        else {

          var callFunction = null;
          if ("실력평가".indexOf(REQ_SUBJ) > -1) {

            //단원 리스트 삭제
            $('div.cStep').remove();
            //이전 리스트 삭제
            $('div.cContent._cContent').remove();
            //이전 왼쪽 리스트를 삭제
            $('#leftLstID').remove();
            callFunction = fnGetListOk2;
          }
          else
            callFunction = fnGetListOk;

          param.user_cd = EUSER_INFO.STUDENT_NO;
          $.postJSON('hexm', '/sigong/test/testList.json', param, callFunction, false, null, null, param);
        }
        return true;
      }
      else {
        //console.log("select sub_subj idx [" + idx + "]");
        alert(REQ_SUBJ + " " + REQ_GRADE + "학년 " + REQ_TERM + "학기 학습은 없습니다.");
        return false;
      }
    }

    //목록 설정
    function fnGetListOk(retData, callbackParam) {

      $('#leftGroupID').removeClass("caseEng");
      if (retData.resultCode == "0") {

        var list = null;

        if (retData.pointNoteLessonList)
          list = retData.pointNoteLessonList;
        else
          list = retData.testList;

        CUR_LIST = list;//컨텐츠 목록 조회 후 현재선택 목록 전역변수에 설정
        var contLst = "";
        var rightLst = "";
        var stepNo = 0;
        var rightFlag = false;
        var isMiddleStep = 0;
        if ("|요점노트|서술형평가|".indexOf(REQ_SUBJ + "|") < 0 && "사회".indexOf(REQ_PRESUBJ_NM) > -1)
          isMiddleStep = 1;
        if ("|서술형평가|단원평가|".indexOf(REQ_SUBJ + "|") > -1 && "통합".indexOf(REQ_PRESUBJ_NM) > -1)
          isMiddleStep = 1;

        if (list != null && list.length > 0) {

          for (var n = 0; n < list.length; n++) {

            if (contLst == "") {

              contLst += '<div class="cContent _cContent active">';

              if ("|실력평가|단원평가|".indexOf(REQ_SUBJ + "|") > -1) {

                contLst += '  <div class="desc">100점이나 틀린 문제 다시풀기를 하면 <i class="i-star"></i>1개, 보충문제를 풀면<i class="i-star"></i>1개</div>';
                contLst += '  <div class="scroll transparent _contentScroll">';// style="height:580px !important"
              }
              else if ("|서술형평가|".indexOf(REQ_SUBJ + "|") > -1) {

                contLst += '  <div class="desc">100점이나 틀린 문제 다시풀기를 하면 <i class="i-star"></i>1개</div>';
                contLst += '  <div class="scroll transparent _contentScroll">';// style="height:580px !important"
              }
              else {

                contLst += '  <div class="scroll transparent _contentScroll">';
              }

              contLst += '    <ul>';
            }

            if (isMiddleStep == 0) {

              contLst += '      <li>';

              if (list[n].right_cnt != null) {

//                 if (list[n].status != 3) {

//                   contLst += '        <a href="#" onClick=\'fnPopOpenMove("' + n + '","' + callbackParam.subj_id + '");\'>';
//                 }
//                 else {

//                   contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
//                 	//contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "RERS");\'>';
//                 }
                 var status = "" + list[n].status;
                 switch(status) {
                   case "0":			// 대기
                	   contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
                	   break;

                   case "1":			// 학습중
                	   contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
                	   break;

//                    case "2":			// 학습완료
//                 	   contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "RER");\'>';
//                 	   break;

                   case "3":			// 채점중
                	   contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "RER");\'>';
                	   break;

                   default:				// -1 등 기타
                	   contLst += '        <a href="#" onClick=\'fnPopOpenMove("' + n + '","' + callbackParam.subj_id + '");\'>';  // 채점결과/다시풀기 팝업 표시
                 }
                contLst += '          <div class="pop num"><span>' + list[n].order_nm + '</span></div>';
                contLst += '          <div class="pop con">';
              } else {
                contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
                // contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "RERS");\'>';
                contLst += '          <div class="num"><span>' + list[n].order_nm + '</span></div>';
                contLst += '          <div class="con">';
              }
              //contLst += '          <div class="num"><span>' + list[n].order_nm + '</span></div>';
              //contLst += '          <div class="con">';
              contLst += '            <span class="page">';
              contLst += langData.ko.SUB_005_003.replace(/N%/, list[n].s_page + '~' + list[n].e_page);
              contLst += '</span>';
              contLst += '            <span class="tit">' + list[n].study_course_nm + '</span>';
              contLst += '          </div>';

              if (list[n].status == 3) {
                contLst += '<div class="i-check"></div>';
              } else {
                if (list[n].right_cnt != null) {
                  contLst += '		  <div class="state-box">';
                  contLst += '			<div class="score-badge">' + list[n].score + '</div>';
                  contLst += '			<div class="study-state">';

                  if ("|실력평가|단원평가|".indexOf(REQ_SUBJ + "|") > -1) {
                    if (list[n].star_cnt == 1) {
                      //contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_half_star.png" alt="">';
                      if (list[n].subj_viw_nm == "국어") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star.png" alt="">';
                      if (list[n].subj_viw_nm == "수학") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_02.png" alt="">';
                      if (list[n].subj_viw_nm == "사회") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_03.png" alt="">';
                      if (list[n].subj_viw_nm == "과학") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_04.png" alt="">';
                      if (list[n].subj_viw_nm == "영어") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_06.png" alt="">';
                      if (list[n].subj_viw_nm == "통합") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_05.png" alt="">';
                    } else if (list[n].star_cnt == 2) {
                      contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_full_star.png" alt="">';
                    } else {
                      contLst += '		<img src="../../img/element/schoolStudy/studyTest/pending_no_star.png" alt="">';
                    }
                  } else if ("|서술형평가|".indexOf(REQ_SUBJ + "|") > -1) {
                    if (list[n].star_cnt > 0) {
                      contLst += '		<img src="../../img/element/schoolStudy/studyTest/study_completed_1star_full_star.png" alt="">';
                    } else {
                      contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_1star_no_star.png" alt="">';
                    }
                  }

                  contLst += '			</div>';
                  contLst += '		  </div>';
                }
              }
              contLst += '        </a>';

              if ("|요점노트|".indexOf(REQ_SUBJ + "|") > -1)
                //point_note_id 내공상자 값  값 넘겨야됨  POST /newTodayStudy/InsertMyBox HTTP/1.1 main_pkid	852   svc_div	S  svc_id	10006  user_id	1954536  user_ip	192.168.0.8
                if(list[n].hasOwnProperty("study_course_id")) {
                    contLst += '        <a href="#" class="btn-box" onclick="fnOpenMyboxConfirm(' + list[n].point_note_id + ', ' + list[n].study_course_id + ')"><span class="sr-only"><span data-text="HOM_002_014">내공상자</span></span></a>';
                } else {
                	contLst += '        <a href="#" class="btn-box" onclick="fnOpenMyboxConfirm(' + list[n].point_note_id + ')"><span class="sr-only"><span data-text="HOM_002_014">내공상자</span></span></a>';
                }

              contLst += '      </li>';
            }
            else if (isMiddleStep == 1) {

              if (isMiddleStep == 1 && list[n].lv == 1) {//중단원이 있는 대단원 목록

                contLst += '<li class="category">';
                contLst += ' <em><span>' + list[n].order_nm + '</span></em>';
                contLst += ' <span style="margin-left:20px;">' + list[n].study_course_nm + '</span>';
                contLst += '</li>';

              }//단원 및 중단원 목록 설정
              else {

                contLst += '      <li>';

                if (list[n].right_cnt != null) {

                  if (list[n].status != 3) {

                    contLst += '        <a href="#" onClick=\'fnPopOpenMove("' + n + '","' + callbackParam.subj_id + '");\'>';
                  }
                  else {

                    contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
                	  //contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "RERS");\'>';
                  }
                  contLst += '          <div class="pop num"><span>' + list[n].order_nm + '</span></div>';
                  contLst += '          <div class="pop con">';
                } else {
                  contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
                //   contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "RERS");\'>';
                  contLst += '          <div class="num"><span>' + list[n].order_nm + '</span></div>';
                  contLst += '          <div class="con">';
                }

                // contLst += '        <a href="#">';
                // contLst += '          <div class="num"><span>' + list[n].order_nm + '</span></div>';
                // contLst += '          <div class="con">';
                contLst += '            <span class="page">';
                contLst += langData.ko.SUB_005_003.replace(/N%/, list[n].s_page + '~' + list[n].e_page);
                contLst += '</span>';
                contLst += '            <span class="tit">' + list[n].study_course_nm + '</span>';
                contLst += '          </div>';

                if (list[n].status == 3) {
                  contLst += '<div class="i-check"></div>';
                } else {
                  if (list[n].right_cnt != null) {
                    contLst += '		  <div class="state-box">';
                    contLst += '			<div class="score-badge">' + list[n].score + '</div>';
                    contLst += '			<div class="study-state">';

                    if ("|실력평가|단원평가|".indexOf(REQ_SUBJ + "|") > -1) {
                      if (list[n].star_cnt == 1) {
                        //contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_half_star.png" alt="">';
                        if (list[n].subj_viw_nm == "국어") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star.png" alt="">';
                        if (list[n].subj_viw_nm == "수학") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_02.png" alt="">';
                        if (list[n].subj_viw_nm == "사회") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_03.png" alt="">';
                        if (list[n].subj_viw_nm == "과학") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_04.png" alt="">';
                        if (list[n].subj_viw_nm == "영어") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_06.png" alt="">';
                        if (list[n].subj_viw_nm == "통합") contLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_sta_05.png" alt="">';
                      } else if (list[n].star_cnt == 2) {
                        contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_full_star.png" alt="">';
                      } else {
                        contLst += '		<img src="../../img/element/schoolStudy/studyTest/pending_no_star.png" alt="">';
                      }
                    } else if ("|서술형평가|".indexOf(REQ_SUBJ + "|") > -1) {
                      if (list[n].star_cnt > 0) {
                        contLst += '		<img src="../../img/element/schoolStudy/studyTest/study_completed_1star_full_star.png" alt="">';
                      } else {
                        contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_1star_no_star.png" alt="">';
                      }
                    }

                    contLst += '			</div>';
                    contLst += '		  </div>';
                  }
                }
                contLst += '        </a>';
                contLst += '      </li>';
              }
            }
          }
          contLst += '    </ul>';
          contLst += '  </div>';
          contLst += '</div>';

          //리스트를 덮어 씌움
          //$('#leftLstID').html(leftLst);
          //이전 리스트 삭제
          $('div.cContent._cContent').remove();
          //신규 리스트 추가
          if (REQ_PRESUBJ_NM == "영어") {

            if ($('#engSubjLstID').length == 0) {

              $('#leftGroupID').addClass("large case3");
              // 20210816 ynjoung modified.
              // 영어 교과서 목록을 그대로 append 하지 않고, 선택된 교과서를 선택해서 append한다
              //$('#leftGroupID').append(REQ_ENG_SUBJ.html);
              var jqElEngSubj = $(REQ_ENG_SUBJ.html);
              jqElEngSubj.find("ul li").removeClass("active");
              var selectedTextbook = jqElEngSubj.find("ul li").filter(function(idx, el) {
                  return ( $(el).find("a").eq(0).text() == REQ_BOOKNAME );
              });

              if(selectedTextbook.length == 0) {
                  // 교과서를 찾아내지 못한 경우
                  jqElEngSubj.find("ul li").eq(0).addClass("active");
              } else {
                  // 교과서를 찾아낸 경우
                  selectedTextbook.addClass("active");
              }

              $('#leftGroupID').append(jqElEngSubj);
            }
          }
          else {

            $('#leftGroupID').removeClass("large case3");
            $('#engSubjLstID').remove();
          }
          //console.log("contLst : " + contLst);
          $('#leftGroupID').append(contLst);

          fnSetListEvent();
        }
      }
      else {

        alert("error");
      }
    }

    //스피드퀴즈 목록 설정
    function fnGetListOk3(retData, callbackParam) {

      $('#leftGroupID').removeClass("caseEng");
      if (retData.resultCode == "0") {

        var list = null;
        list = retData.data;
        CUR_LIST = list;//컨텐츠 목록 조회 후 현재선택 목록 전역변수에 설정

        var contLst = "";
        var rightLst = "";
        var stepNo = 0;
        var rightFlag = false;
        var isMiddleStep = 0;
        if ("사회".indexOf(REQ_PRESUBJ_NM) > -1)
          isMiddleStep = 1;

        if (list != null && list.length > 0) {

          for (var n = 0; n < list.length; n++) {

            if (contLst == "") {

              contLst += '<div class="cContent _cContent active">';
              contLst += '  <div class="scroll transparent _contentScroll">';
              contLst += '    <ul>';
            }

            if (isMiddleStep == 0) {

              contLst += '      <li>';
              contLst += '        <a href="#" onClick=\'fnOpenStudy("'+n+'","'+callbackParam.subj_id+'", "B");\'>';
              contLst += '          <div class="num"><span>' + list[n].order_no + list[n].lv_nm + '</span></div>';
              contLst += '          <div class="con">';
              contLst += '            <span class="page">';
              contLst += langData.ko.SUB_005_003.replace(/N%/, list[n].s_page + '~' + list[n].e_page);
              contLst += '</span>';
              contLst += '            <span class="tit">' + list[n].study_course_nm + '</span>';
              contLst += '          </div>';
              if (list[n].end_dttm != null) {  // 스피드퀴즈 완료시
                  contLst += '          <div class="state-box speed">';
                  contLst += '            <div class="study-state">';
                  var imgFile = "";
                  if (list[n].total_count == list[n].correct_count) {
                    if(list[n].subj_viw_nm == "국어") {
                      imgFile = "icon_test_finish_01.png";
                    } else if(list[n].subj_viw_nm == "수학") {
                      imgFile = "icon_test_finish_02.png";
                    } else if(list[n].subj_viw_nm == "사회") {
                      imgFile = "icon_test_finish_03.png";
                    } else if(list[n].subj_viw_nm == "과학") {
                      imgFile = "icon_test_finish_04.png";
                    // } else if(list[n].subj_viw_nm == "영어") { // 영어는 과목명이 아니라 출판사명을 받는다
                    } else if(["영어", "대교", "동아출판", "YBM 김혜리", "YBM 최희경", "천재교육"].includes(list[n].subj_viw_nm)) {
                      imgFile = "icon_test_finish_05.png";
                    }
                    contLst += '              <img src="../../img/element/speedQuiz/' + imgFile + '" />';
                  } else {
                    var imgNumber = "00";
                    if(list[n].subj_viw_nm == "국어")      { imgNumber = "01"; }
                    else if(list[n].subj_viw_nm == "수학") { imgNumber = "02"; }
                    else if(list[n].subj_viw_nm == "사회") { imgNumber = "03"; }
                    else if(list[n].subj_viw_nm == "과학") { imgNumber = "04"; }
                    //else if(list[n].subj_viw_nm == "영어") // 영어는 과목명이 아니라 출판사명을 받는다
                    else if(["영어", "대교", "동아출판", "YBM 김혜리", "YBM 최희경", "천재교육"].includes(list[n].subj_viw_nm)) {
                      imgNumber = "05";
                    }

                    var imgLevel = "00";
                    var score = Math.round(((list[n].correct_count / list[n].total_count) * 100) / 4);
                    if(score <= 1)       { imgLevel = "01"; }
                    else if(score <= 4)  { imgLevel = "02"; }
                    else if(score <= 7)  { imgLevel = "03"; }
                    else if(score <= 10) { imgLevel = "04"; }
                    else if(score <= 13) { imgLevel = "05"; }
                    else if(score <= 16) { imgLevel = "06"; }
                    else if(score <= 19) { imgLevel = "07"; }
                    else if(score <= 22) { imgLevel = "08"; }
                    else if(score <= 24) { imgLevel = "09"; }
                    else if(score <= 25) { imgLevel = "10"; }

                    imgFile = "icon_subject_" + imgNumber + "_right_" + imgLevel + ".png";

                    contLst += '              <p class="correct_title">맞힌문제</p>';
                    contLst += '              <p class="count"><span class="correct_count">'+list[n].correct_count+'</span>/<span class="total_count">'+list[n].total_count+'</span></P>'
                    //contLst += '              ' + list[n].correct_count + '/' + list[n].total_count + '<br />';
                    contLst += '              <img src="../../img/element/speedQuiz/' + imgFile + '" />';
                  }
                  contLst += '            </div>';
                  contLst += '          </div>';
                }
              contLst += '        </a>';
              contLst += '      </li>';
            }
            else if (isMiddleStep == 1) {

              if (isMiddleStep == 1 && list[n].lv == 1) {//중단원이 있는 대단원 목록

                contLst += '<li class="category">';
                contLst += ' <em><span>' + list[n].order_no + list[n].lv_nm + '</span></em>';
                contLst += ' <span style="margin-left:20px;">' + list[n].study_course_nm + '</span>';
                contLst += '</li>';

              }//단원 및 중단원 목록 설정
              else {

                contLst += '      <li>';
                contLst += '        <a href="#" onClick=\'fnOpenStudy("' + n + '","' + callbackParam.subj_id + '", "B");\'>';
                contLst += '          <div class="num"><span>' + list[n].order_no + list[n].lv_nm + '</span></div>';
                contLst += '          <div class="con">';
                contLst += '            <span class="page">';
                contLst += langData.ko.SUB_005_003.replace(/N%/, list[n].s_page + '~' + list[n].e_page);
                contLst += '</span>';
                contLst += '            <span class="tit">' + list[n].study_course_nm + '</span>';
                contLst += '          </div>';
                if (list[n].end_dttm != null) {  // 스피드퀴즈 완료시
                    contLst += '          <div class="state-box speed">';
                    contLst += '            <div class="study-state speed">';
                    var imgFile = "";
                    if (list[n].total_count == list[n].correct_count) {
                      if(list[n].subj_viw_nm == "국어") {
                        imgFile = "icon_test_finish_01.png";
                      } else if(list[n].subj_viw_nm == "수학") {
                        imgFile = "icon_test_finish_02.png";
                      } else if(list[n].subj_viw_nm == "사회") {
                        imgFile = "icon_test_finish_03.png";
                      } else if(list[n].subj_viw_nm == "과학") {
                        imgFile = "icon_test_finish_04.png";
                      // } else if(list[n].subj_viw_nm == "영어") { // 영어는 과목명이 아니라 출판사명을 받는다
                      } else if(["영어", "대교", "동아출판", "YBM 김혜리", "YBM 최희경", "천재교육"].includes(list[n].subj_viw_nm)) {
                        imgFile = "icon_test_finish_05.png";
                      }
                      contLst += '              <img src="../../img/element/speedQuiz/' + imgFile + '" />';
                    } else {
                      var imgNumber = "00";
                      if(list[n].subj_viw_nm == "국어")      { imgNumber = "01"; }
                      else if(list[n].subj_viw_nm == "수학") { imgNumber = "02"; }
                      else if(list[n].subj_viw_nm == "사회") { imgNumber = "03"; }
                      else if(list[n].subj_viw_nm == "과학") { imgNumber = "04"; }
                      //else if(list[n].subj_viw_nm == "영어") // 영어는 과목명이 아니라 출판사명을 받는다
                      else if(["영어", "대교", "동아출판", "YBM 김혜리", "YBM 최희경", "천재교육"].includes(list[n].subj_viw_nm)) {
                        imgNumber = "05";
                      }

                      var imgLevel = "00";
                      var score = Math.round(((list[n].correct_count / list[n].total_count) * 100) / 4);
                      if(score <= 1)       { imgLevel = "01"; }
                      else if(score <= 4)  { imgLevel = "02"; }
                      else if(score <= 7)  { imgLevel = "03"; }
                      else if(score <= 10) { imgLevel = "04"; }
                      else if(score <= 13) { imgLevel = "05"; }
                      else if(score <= 16) { imgLevel = "06"; }
                      else if(score <= 19) { imgLevel = "07"; }
                      else if(score <= 22) { imgLevel = "08"; }
                      else if(score <= 24) { imgLevel = "09"; }
                      else if(score <= 25) { imgLevel = "10"; }

                      imgFile = "icon_subject_" + imgNumber + "_right_" + imgLevel + ".png";

                      // contLst += '              맞힌문제<br />';
                      // contLst += '              ' + list[n].correct_count + '/' + list[n].total_count + '<br />';
                      // contLst += '              <img src="../../img/element/speedQuiz/' + imgFile + '" />';

                      contLst += '              <p class="correct_title">맞힌문제</p>';
                      contLst += '              <p class="count"><span class="correct_count">'+list[n].correct_count+'</span>/<span class="total_count">'+list[n].total_count+'</span></P>'
                      //contLst += '              ' + list[n].correct_count + '/' + list[n].total_count + '<br />';
                      contLst += '              <img src="../../img/element/speedQuiz/' + imgFile + '" />'
                    }
                    contLst += '            </div>';
                    contLst += '          </div>';
                  }
                contLst += '        </a>';
                contLst += '      </li>';
              }
            }
          }
          contLst += '    </ul>';
          contLst += '  </div>';
          contLst += '</div>';

          //리스트를 덮어 씌움
          //$('#leftLstID').html(leftLst);
          //이전 리스트 삭제
          $('div.cContent._cContent').remove();
          //신규 리스트 추가
          if (REQ_PRESUBJ_NM == "영어") {

            if ($('#engSubjLstID').length == 0) {

              $('#leftGroupID').addClass("large case3");
              // 20210816 ynjoung modified.
              // 영어 교과서 목록을 그대로 append 하지 않고, 선택된 교과서를 선택해서 append한다
              //$('#leftGroupID').append(REQ_ENG_SUBJ.html);
              var jqElEngSubj = $(REQ_ENG_SUBJ.html);
              jqElEngSubj.find("ul li").removeClass("active");
              var selectedTextbook = jqElEngSubj.find("ul li").filter(function(idx, el) {
                  return ( $(el).find("a").eq(0).text() == REQ_BOOKNAME );
              });

              if(selectedTextbook.length == 0) {
                  // 교과서를 찾아내지 못한 경우
                  jqElEngSubj.find("ul li").eq(0).addClass("active");
              } else {
                  // 교과서를 찾아낸 경우
                  selectedTextbook.addClass("active");
              }

              $('#leftGroupID').append(jqElEngSubj);
            }
          }
          else {

            $('#leftGroupID').removeClass("large case3");
            $('#engSubjLstID').remove();
          }
          //console.log("contLst : " + contLst);
          $('#leftGroupID').append(contLst);

          fnSetListEvent();
        }
      }
      else {

        alert("error");
      }
    }

    ////point_note_id 내공상자 값  값 넘겨야됨  POST /newTodayStudy/InsertMyBox HTTP/1.1 main_pkid	852   svc_div	S  svc_id	10006  user_id	1954536  user_ip	192.168.0.8
    //내공상자 담기
    function fnOpenMyboxConfirm(point_note_id, study_course_id) {
      //내공상자에 담으시겠습니까?
      commonConfirm("SUB_014_002", null, function () {
        var param = {
          svc_id: "10006",
          user_id: EUSER_INFO.USER_ID,
          svc_div: "S",
          main_pkid: point_note_id
        };
        if(study_course_id) {
          param["study_course_id"] = study_course_id;
        }
        //main_pkid	8826	svc_id	10001	user_id	1955240	svc_div	U
        $.postJSON('hapi', '/newTodayStudy/InsertMyBox', param, fnInsertMyBoxOk, false);
      });

    }

    //내공상자 호훌 후 처리
    function fnInsertMyBoxOk(retData) {
      if (!$.isEmpty(retData.dupl) && retData.dupl > 0) {
        //dupl=1, result=0, resultCode=-4
        //이미 내공상자에 담겼습니다.
        commonAlert("SUB_014_004");
      } else if (!$.isEmpty(retData.result) && retData.result > 0) {
        //dupl=0, result=1, resultCode=0
        //내공상자에 담겼습니다.
        commonAlert("SUB_014_003");
      } else {
        //다시 시도해 주세요.
        commonAlert("SUB_901_051");
      }
    }

    //실력평가 목록 설정
    function fnGetListOk2(retData, callbackParam) {

      if (retData.resultCode == "0") {

        var list = retData.testList;
        CUR_LIST = list;//컨텐츠 목록 조회 후 현재선택 목록 전역변수에 설정

        var leftLst = "";
        var rightLst = "";
        var stepNo = 0;
        var rightFlag = false;
        var isMiddleStep = false;
        var divClass = null;
        if ("사회".indexOf(REQ_PRESUBJ_NM) > -1)
          isMiddleStep = true;

        if (list != null && list.length > 0) {

          if (REQ_PRESUBJ_NM == "국어")
            divClass = "kor";
          else if (REQ_PRESUBJ_NM == "수학")
            divClass = "math";
          else if (REQ_PRESUBJ_NM == "사회")
            divClass = "society";
          else if (REQ_PRESUBJ_NM == "과학")
            divClass = "science";
          else if (REQ_PRESUBJ_NM == "영어")
            divClass = "english";
          else if (REQ_PRESUBJ_NM == "통합")
            divClass = "combine";

          leftLst += '<div class="cStep active ' + divClass + ' _cStep">';
          leftLst += '  <div class="scroll transparent _stepScroll">'; //style="height: 629px"
          leftLst += '    <ul id="leftLstID"><!-- leftLstID ID 지정 필수 -->';
          for (var n = 0; n < list.length; n++) {

            if (isMiddleStep && list[n].lv == 1) {//중단원이 있는 대단원 목록

              leftLst += '<li class="category">';
              leftLst += ' <em><span>' + list[n].order_nm + '</span></em>';
              leftLst += ' <span>' + list[n].study_course_nm + '</span>';
              leftLst += '</li>';

            }//단원 및 중단원 목록 설정
            else if (list[n].lv == 1 || (isMiddleStep && list[n].lv == 2)) {

              ++stepNo;
              rightFlag = true;
              if (stepNo == 1)
                leftLst += `<li class='active' onclick='fnOnMidList(${n});'>`;
              else
                leftLst += `<li onclick='fnOnMidList(${n});'>`;
              leftLst += ' <a href="#" data-id="step' + stepNo + '">';
              leftLst += '   <span class="step">' + list[n].order_nm + '</span>';

              if ("영어".indexOf(REQ_SUBJ) > -1 && false) {

                var scm = list[n].study_course_nm;
                if (scm.length > 32)
                  scm = scm.substring(0, 32) + "...";
                leftLst += '		<span class="tit">' + scm + '</span>';
              }
              else
                leftLst += '		<span class="tit">' + list[n].study_course_nm + '</span>';
                leftLst += '	</a>';
                leftLst += '</li>';
            }
            else {//오른쪽 리스트

              if (rightFlag) {
                if (stepNo == 1)
                  rightLst += '<div class="cContent cContentSmall _cContent active" data-id="step' + stepNo + '">';
                else
                  rightLst += '<div class="cContent cContentSmall _cContent" data-id="step' + stepNo + '">';

                rightLst += '  <div class="desc">100점이나 틀린 문제 다시풀기를 하면 <i class="i-star"></i>1개, 보충문제를 풀면<i class="i-star"></i>1개</div>';
                rightLst += '  <div class="scroll transparent _contentScroll">';// style="height:580px !important"
                rightLst += '	  <ul>';

                rightFlag = false;
              }
              if (list[n].right_cnt != null) {
                if (list[n].status != 3) {

                  rightLst += '	    <li onClick="fnPopOpenMove(\'' + n + '\',\'' + callbackParam.subj_id +'\')">';
                }
                else{

                  rightLst += '	    <li>';
                }
              } else {
                rightLst += '	    <li onClick=\'fnOpenStudy("'+n+'","'+callbackParam.subj_id+'", "B");\'>';
              }
              //rightLst += '	      <div class="num">' + list[n].order_nm + '</div>';
              //rightLst += '	      <div class="con">';

              if (list[n].right_cnt != null) {
                rightLst += '          <div class="pop num"><span>' + list[n].order_nm + '</span></div>';
                rightLst += '          <div class="pop con">';
              } else {
                rightLst += '          <div class="num"><span>' + list[n].order_nm + '</span></div>';
                rightLst += '          <div class="con">';
              }

              rightLst += '	        <span class="page">' + list[n].s_page + '~' + list[n].e_page + '<span data-text="SUB_005_003">쪽</span></span>';


              if (list[n].status == 3) {
                rightLst += '<div class="i-check"></div>';
              } else {
                if (list[n].right_cnt != null) {
                  rightLst += '	        <span class="tit lineEllip">' + list[n].study_course_nm + '</span>';
                  rightLst += '	      </div>';
                  rightLst += '		  <div class="state-box">';
                  rightLst += '			<div class="test-state">';
                  //20220224 수정 시작
                  if(list[n].wrong_cnt != 0) {
                    rightLst += '				<div class="state-correct">' + list[n].right_cnt + ' 문제</div>';
                    rightLst += '				<div class="state-wrong">' + list[n].wrong_cnt + ' 문제</div>';
                  } else {
                    rightLst += '			<div class="state-perfect"></div>';
                  }
                  //20220224 수정 끝
                  rightLst += '			</div>';
                  rightLst += '			<div class="study-state">';

                  if (list[n].star_cnt == 1) {
                    //contLst += '		<img src="../../img/element/schoolStudy/studyTest/completed_half_star.png" alt="">';
                    if (list[n].subj_viw_nm == "국어") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star.png" alt="">';
                    if (list[n].subj_viw_nm == "수학") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_02.png" alt="">';
                    if (list[n].subj_viw_nm == "사회") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_03.png" alt="">';
                    if (list[n].subj_viw_nm == "과학") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_04.png" alt="">';
                    if (list[n].subj_viw_nm == "영어") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_06.png" alt="">';
                    if (list[n].subj_viw_nm == "통합") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_half_star_05.png" alt="">';
                  } else if (list[n].star_cnt == 2) {
                    if (list[n].subj_viw_nm == "국어") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_full_star.png" alt="">';
                    if (list[n].subj_viw_nm == "수학") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_full_star_02.png" alt="">';
                    if (list[n].subj_viw_nm == "사회") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_full_star_03.png" alt="">';
                    if (list[n].subj_viw_nm == "과학") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_full_star_04.png" alt="">';
                    if (list[n].subj_viw_nm == "영어") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_full_star_06.png" alt="">';
                    if (list[n].subj_viw_nm == "통합") rightLst += '<img src="../../img/element/schoolStudy/studyTest/completed_full_star_05.png" alt="">';
                  } else {
                    rightLst += '			<img src="../../img/element/schoolStudy/studyTest/pending_no_star.png" alt="">';
                  }
                  rightLst += '			</div>';
                  rightLst += '		  </div>';
              }else {
                  rightLst += '	        <span class="tit">' + list[n].study_course_nm + '</span>';
                  rightLst += '	      </div>';
                  }
              }
              rightLst += '	    </li>';

              if (list.length == (n + 1) || list[n + 1].lv == 1 || (isMiddleStep && list[n + 1].lv == 2)) {//다음이 끝이건, 단원이거나 중단원인경우 오른쪽 div 닫기

                rightLst += '	  </ul>';
                rightLst += '	</div>';
                rightLst += '</div>';
              }
            }
          }
          leftLst += '    </ul>';
          leftLst += '  </div>';
          leftLst += '</div>';


          //신규 리스트 추가
          if (REQ_PRESUBJ_NM == "영어") {

            if ($('#engSubjLstID').length == 0) {

              $('#leftGroupID').removeClass("case3");
              $('#leftGroupID').addClass("large caseEng");
              $('#leftGroupID').append(REQ_ENG_SUBJ.html);
            }
          }
          else {
            $('#leftGroupID').removeClass("caseEng");
            $('#engSubjLstID').remove();
            //왼쪽 리스트를 추가
            $('#leftGroupID').addClass("large");
          }
          $('#leftGroupID').append(leftLst);
          //신규 리스트 추가
          $('#leftGroupID').append(rightLst);

          fnSetListEvent();
        }
      }
      else {

        alert("error");
      }
    }

    function fnSetListEvent() {
      var type = 0;

      if ("|실력평가|".indexOf(REQ_SUBJ + "|") > -1) {
        type = 2;
      }
      else {//요점노트,스피드퀴즈,단원평가,서술형평가 모두 동일

        if ("|영어|".indexOf("|" + REQ_PRESUBJ_NM + "|") > -1) {
          type = 3;
        }
        else {
          type = 1;
        }
      }

      switch (type) {

        case 1:

          // $('._contentScroll').mCustomScrollbar();
          // 메뉴 탭
          $('._cMenu li a').click(function () {
            $('._cContent').removeClass('active')
            $('._cContent[data-id=\'' + $(this).attr('data-id') + '\']').addClass('active')
            $('._cMenu li a').parent().removeClass('active')
            $(this).parent().addClass('active')
          });
          break;

        case 2:
          // $('._contentScroll').mCustomScrollbar();
          // $('._stepScroll').mCustomScrollbar();

          $('._cStep li a').click(function () {
            $('._cContent').removeClass('active');
            $('._cContent[data-id=\'' + $(this).attr('data-id') + '\']').addClass('active');
            $('._cStep li a').parent().removeClass('active');
            $(this).parent().addClass('active')
          });

          $('._cMenu li a').click(function () {
            $('._cStep').removeClass('active');
            $('._cStep[data-id=\'' + $(this).attr('data-id') + '\']').addClass('active');
            $('._cMenu li a').parent().removeClass('active');
            $(this).parent().addClass('active')
          });

          $('._cCategory li a').click(function () {
            console.log($(this).html());
            $('._cCategory li').removeClass('active')
            $(this).parent().addClass('active')
          });
          break;

        case 3:

            $('._cMenu li a').click(function () {
                $('._cStep').removeClass('active');
                $('._cStep[data-id=\'' + $(this).attr('data-id') + '\']').addClass('active');
                $('._cMenu li a').parent().removeClass('active');
                $(this).parent().addClass('active')
              });

          // $('._contentScroll').mCustomScrollbar();
          $('._cCategory li a').click(function () {
            console.log($(this).html());
            $('._cCategory li').removeClass('active')
            $(this).parent().addClass('active')
          });
          break;
      }
    }


    //컨텐츠 실행 명령
    function fnOpenStudy(idx, subj_id, typeDv, isCallXCaliper, isScoreResult) {
      if(!CUR_LIST || CUR_LIST.length <= idx){

        commonAlert("선택된 목록을 알 수 없습니다.</br>목록을 다시 실행하여 주세요.");
        return;
      }
      var exam = CUR_LIST[idx];

      var param = null;
      var xc_cType = null;
      var xc_name = null;
      if(exam.order_nm == null || exam.order_nm == 'undefined'){
	      xc_name = `${exam.study_course_nm}`;
      }else{
	      xc_name = `${exam.order_nm} ${exam.study_course_nm}`;
      }
      var xc_desc = "";
      if(REQ_PRESUBJ_NM == "영어")
        xc_desc = `${PAGE_TITLE}>${REQ_SUBJ}>${REQ_PRESUBJ_NM}>${REQ_SUBJ_VNM}>${xc_name}`;
      else
        xc_desc = `${PAGE_TITLE}>${REQ_SUBJ}>${REQ_SUBJ_VNM}>${xc_name}`;

      if(!$.isEmpty(exam.cont_id) && exam.cont_id.indexOf(".pdf") > -1)
        xc_cType = "application";
      else
        xc_cType = "text";

      var OD1 = null;
      OD1 = `${REQ_GRADE}학년 ${REQ_TERM}학기`;

      var OD2 = null;
      if (PAGE_TITLE)
        OD2 = PAGE_TITLE;

      var OD3 = null;
      if (exam.subj_viw_nm)
        OD3 = exam.subj_viw_nm;

      var OD4 = null;
      if ($('#leftLstID li.active a span.step').length > 0)
        OD4 = $('#leftLstID li.active a span.step').text() +" "+ $('#leftLstID li.active a span.tit').text();

      var OD5 = null;
      if (xc_name)
        OD5 = xc_name;

      isCallXCaliper = (
          (isCallXCaliper == undefined || isCallXCaliper == null) ?
          true : isCallXCaliper
      );

      //xcaliper 적용
      if(isCallXCaliper)
          xNaviEvent(xc_name, exam.study_course_id, xc_desc, "C", xc_cType, OD1, OD2, OD3, OD4, OD5);

      if ("|요점노트|".indexOf(REQ_SUBJ + "|") > -1){

        var title = exam.order_nm + " " + exam.study_course_nm;
        param = "?pdfurl=" + encodeURIComponent("https://xcdn.home-learn.com"+exam.cont_id);
        param += "&title=" + encodeURIComponent(title);

        console.log("Test result detail param :: " + param);
        openWebView("/contents/Elementary/EmtNote" + param);
      }
      else if ("|스피드퀴즈|".indexOf(REQ_SUBJ + "|") > -1) {

        param = "SchoolStudy://";
        param += "?subj_lesson_no=" + exam.study_course_id;
        param += "&study_course_id=" + exam.study_course_id;
        param += "&subj_no=" + exam.subj_id;
        param += "&grade_div=" + REQ_GRADE;
        param += "&term_cd=" + REQ_TERM;
        param += "&module_no=";
        param += "&plan_de=";
        param += "&student_no=" + EUSER_INFO.STUDENT_NO;
        param += "&user_id=" + EUSER_INFO.USER_ID;
        param += "&studying=N";
        param += "&adminmode=N";
        param += "&testMode=N";
        param += "&subj_viw_nm=" + exam.subj_viw_nm;
        param += "&pre_subj_nm=" + REQ_PRESUBJ_NM;
        param += "&svc_nm=스피드퀴즈";

        //console.log("Test result detail param :: " + param);
        // openWebView("/contents/Elementary/EmtNote" + param);

        ifCallScheme(param);
      }
      else {

        //처음 풀면
        if (typeDv == "B" || typeDv == "I") {
          if(exam.mid_final_div == null)
            exam.mid_final_div = 0;
        }

        param = "?typeDv=" + typeDv;
        param += "&mid_final_div=" + exam.mid_final_div;

        param += "&grade_div=" + encodeURIComponent(REQ_GRADE);
        param += "&term_cd=" + encodeURIComponent(REQ_TERM);
        param += "&exam_div=" + encodeURIComponent(exam.exam_div);
        param += "&eid=" + encodeURIComponent(exam.exam_id);
        param += "&user_cd=" + encodeURIComponent(EUSER_INFO.STUDENT_NO);
        param += "&user_id=" + encodeURIComponent(EUSER_INFO.USER_ID);
        param += "&top_course_id=" + encodeURIComponent(exam.top_course_id);
        param += "&subj_id=" + encodeURIComponent(subj_id);
        param += "&subj=" + encodeURIComponent(REQ_PRESUBJ_NM);
        param += "&page=" + encodeURIComponent(exam.s_page + '쪽~' + exam.e_page + "쪽");
        param += "&title=" + encodeURIComponent(REQ_SUBJ);
        if (typeDv != "B") {
          param += "&stid=" + encodeURIComponent(exam.stu_test_id);
        }
        param += "&introduction=" + encodeURIComponent("평가학습");		// xCaliper 추가 데이터
        // `x단원 과목명`
        param += "&introductionTitle=" + encodeURIComponent($("#leftLstID li.active span.step").text() + " " + $("#leftLstID li.active span.tit").text());
        // 채점결과 버튼을 통해 들어온 경우
        if(isScoreResult == "Y") {
            param += "&listResult=y";
        }

        console.log("Test result detail param :: " + param);
        openWebView("/contents/emtExam.html" + param);
      }
    }


    function fnPopOpenMove(idx, subj_id) {

      if (!CUR_LIST || CUR_LIST.length <= idx) {

        commonAlert("선택된 목록을 알 수 없습니다.</br>목록을 다시 실행하여 주세요.");
        return;
      }
      var exam = CUR_LIST[idx];

      $('#studyPopupFrom').empty();
      var html = '';
      html += '<div class="title-area">';
      html += '	<h2 class="title"><span>' + exam.order_nm + '</span><span>' + exam.study_course_nm + '</span></h2>';
      html += '	<a href="#" class="btn-close" data-dismiss="modal" aria-label="Close"><img src="../../img/element/main/btn_X.png" alt=""></a>';
      html += '</div>';
      html += '<div class="question-type">';
      html += '	<div class="title">문제유형</div>';
      html += '	<div class="type">';
      if (exam.choice_cnt > 0) {
        html += '	<div class="q-badge"><span>객관식</span><span>' + exam.choice_cnt + '문제</span></div>';
      }
      if (exam.answer_cnt > 0) {
        html += '	<div class="q-badge"><span>주관식</span><span>' + exam.answer_cnt + '문제</span></div>';
      }
      if (exam.text_cnt > 0) {
        html += '	<div class="q-badge"><span>서술형</span><span>' + exam.text_cnt + '문제</span></div>';
      }

      html += '	</div>';
      html += '</div>';
      html += '<div class="study-select-box">';
      html += '	<div class="title">학습하기</div>';
      html += '	<ul>';

      //시험보기
      html += '		<li class="completed">';
      html += '			<div class="img"><img src="../../img/element/schoolStudy/popup/btn_view_test.png" alt=""></div>';
      html += '			<a href="#" onclick="fnOpenStudy(\''+idx+'\',\''+ subj_id+'\',\'RER\', false, \'Y\');">채점결과</a>';
      html += '		</li>';

      //틀린문제
      if (exam.star_cnt == 0) {
        html += '		<li class="supplementary now">';
        html += '			<div class="img"><img src="../../img/element/schoolStudy/popup/btn_wrong_test.png" alt=""></div>';
        html += '			<a href="#" onclick="fnOpenStudy(\''+idx+'\',\''+ subj_id+'\',\'RERS\');">다시풀기</a>';
      } else {
        html += '		<li class="completed">';
        html += '			<div class="img"><img src="../../img/element/schoolStudy/popup/btn_wrong_test.png" alt=""></div>';
        html += '			<a href="#" onclick="fnOpenStudy(\''+idx+'\',\''+ subj_id+'\',\'RERSR\', false, \'Y\');">채점결과</a>';
      }
      html += '		</li>';

      if (exam.ibf_yn == "Y") {
        //보충문제
        if (exam.star_cnt == 1) {
          html += '		<li class="supplementary now">';
          html += '			<div class="img"><img src="../../img/element/schoolStudy/popup/btn_supplementary_test.png" alt=""></div>';
          html += '			<a href="#" onclick="fnOpenStudy(\''+idx+'\',\''+ subj_id+'\',\'I\');">문제풀기</a>';
        } else if (exam.star_cnt == 2) {
          html += '		<li class="completed">';
          html += '			<div class="img"><img src="../../img/element/schoolStudy/popup/btn_supplementary_test.png" alt=""></div>';
          html += '			<a href="#" onclick="fnOpenStudy(\''+idx+'\',\''+ subj_id+'\',\'IR\', false, \'Y\');">채점결과</a>';
        } else if (exam.star_cnt == 0) {
          html += '		<li class="supplementary">';
          html += '			<div class="img"><img src="../../img/element/schoolStudy/popup/btn_supplementary_test.png" alt=""></div>';
          html += '			<a href="#" onclick="fnOpenStudy(\''+idx+'\',\''+ subj_id+'\',\'I\');">문제풀기</a>';
        }
      }

      html += '		</li>';
      html += '	</ul>';
      html += '</div>';

      $('#studyPopupFrom').append(html);
      $('#openPopup').modal('show');
    }


    //목록중 선택 xcaliper
    function fnOnMidList(idx){

      var study = CUR_LIST[idx];
      var xc_desc = study.order_nm + " " + study.study_course_nm;

      var OD1 = null;
      OD1 = `${REQ_GRADE}학년 ${REQ_TERM}학기`;

      var OD2 = null;
      if (PAGE_TITLE)
        OD2 = PAGE_TITLE;

      var OD3 = null;
      if (study.subj_viw_nm)
        OD3 = study.subj_viw_nm;

      var OD4 = xc_desc;

      //xcaliper 적용
      xNaviEvent(OD4, "", `${PAGE_TITLE}>${REQ_SUBJ}>${REQ_SUBJ_VNM}>${xc_desc}`, "M", null, OD1, OD2, OD3, OD4);
    }

	/**
	 * URL 변경
	 */
	function fnChangeURL(queryStringObj) {
		var fullpath = "/es/html/school/eTestList.html";
		var subj = fnGetParam("subj");
		var tab = fnGetParam("tab");
		var grade = fnGetParam("grade");
		var term = fnGetParam("term");
		var bookname = fnGetParam("bookname");

		if(queryStringObj && queryStringObj.subj) {
			subj = queryStringObj.subj
		}
		if(queryStringObj && queryStringObj.tab) {
			tab = queryStringObj.tab;
		}
		if(queryStringObj && queryStringObj.grade) {
			grade = queryStringObj.grade;
		}
		if(queryStringObj && queryStringObj.term) {
			term = queryStringObj.term;
		}
		if(queryStringObj && queryStringObj.bookname) {
			bookname = queryStringObj.bookname
		}
		// 단, 교과서 이름은 영어 과목이 아니면 의미가 없음
		//if($("#subjLstID ul li.active").text().trim() != "영어") {
		//if(localStorage.getItem("ECO_CURRENT_MENU") != "영어") {
		if($("#engSubjLstID").length == 0) {
			bookname = "";
		}

		var fullUrl = fullpath = "?" +
				(!$.isEmpty(subj) ? "subj=" + encodeURIComponent(subj) + "&" : "") +
				(!$.isEmpty(tab) ? "tab=" + tab + "&" : "") +
				(!$.isEmpty(grade) ? "grade=" + grade + "&" : "") +
				(!$.isEmpty(term) ? "term=" + term + "&" : "") +
				(!$.isEmpty(bookname) ? "bookname=" + encodeURIComponent(bookname) : "");

		console.log("url changed", fullUrl);
		replaceHistory(fullUrl);
	}

	window.onResume = function() {
		// 스피드퀴즈가 선택된 상태에서 onResume 발생시 항목들을 새로 읽어온다
		if($("#tab_3").hasClass("active")) {
			// 선택된 과목의 idx
			var idx = $("#subjLstID ul li.active").index();

			// 새로 읽어온다
			fnGetList(idx, false, false);
		}
	}

  </script>
</head>


<body>
  <div class="entireWrap evalStudy">
    <div id="tabMenuID" class="wrap_school_study testStudy">
      <!-- tabMenuID ID 지정 필수 -->
      <!-- combine -- 과학/통합 공통 색상 사용? -->
      <div class="bg_top_large">
        <div class="bg_top">
          <div class="tit"><!-- <span data-text="SUB_010_001">학교공부평가</span> --><span>평가학습</span><span class="badge-info" data-href="">
              <a href="#" data-toggle="modal" data-target="#introStudy"><img
                  src="../../img/element/schoolStudy/studyTest/btn_info.png" alt=""></a></span></div>
          <div class="customSelect"><span id="topGradeViewID"></span><!-- topGradeViewID ID 지정 필수 -->
            <ul id="topGradeID">
              <!-- topGradeID ID 지정 필수 -->
              <li data-value="1">1학년 1학기</li>
              <li data-value="2">1학년 2학기</li>
              <li data-value="3">2학년 1학기</li>
              <li data-value="4">2학년 2학기</li>
              <li data-value="5">3학년 1학기</li>
              <li data-value="6">3학년 2학기</li>
              <li data-value="7">4학년 1학기</li>
              <li data-value="8">4학년 2학기</li>
              <li data-value="9">5학년 1학기</li>
              <li data-value="10">5학년 2학기</li>
              <li data-value="11">6학년 1학기</li>
              <li data-value="12">6학년 2학기</li>
            </ul>
            <input type="hidden" id="customSelectID" name="customSelect" value="1"><!-- customSelectID ID 지정 필수 -->
          </div>
          <a href="#" class="btn-close" id="closeBtnID"><span class="sr-only">close</span>
          </a>
        </div>
        <div class="menu_top">
          <ul>
            <!-- tab_# ID 지정 필수 -->
            <li id="tab_1"><a href="#" data-text="SUB_001_015">요점노트</a></li>
            <li id="tab_2"><a href="#" data-text="SUB_001_010">실력평가</a></li>
            <li id="tab_3"><a href="#" data-text="SUB_002_008">스피드퀴즈</a></li>
            <li id="tab_4"><a href="#" data-text="SUB_001_011">단원평가</a></li>
            <li id="tab_5"><a href="#" data-text="SUB_001_012">서술형평가</a></li>
          </ul>
        </div>
      </div>
      <div class="category_content _categoryContent active" data-id="categoryMenu1" id="leftGroupID">
        <!-- leftLstID ID 지정 필수 -->
        <div id="subjLstID" class="cMenu active _cMenu">
        </div>
        <div id="engSubjLstID" class="cCategory _cCategory" style="display: none;">
        </div>
      </div>
    </div>
  </div>
  <div class="modal modal-info etc_info fade" id="introStudy" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <a href="#" class="btn-close" data-dismiss="modal" aria-label="Close">
          <img src="../../img/element/special/koreanHistory/btn_X.png" alt=""></a>
        <div class="content">
          <img src="../../img/element/schoolStudy/studyTest/info.png" alt="">
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade popup_school_study" id="openPopup" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content" id="studyPopupFrom">
        <!-- <div class="title-area">
        <h2 class="title"><span>1단원</span><span>비유하는 표현</span></h2>
        <a href="#" class="btn-close" data-dismiss="modal" aria-label="Close"><img src="../../img/element/main/btn_X.png" alt=""></a>
      </div>
      <div class="question-type">
        <div class="title">문제유형</div>
        <div class="type">
          <div class="q-badge">
            <span>객관식</span>
            <span>11문제</span>
          </div>
          <div class="q-badge">
            <span>주관식</span>
            <span>4문제</span>
          </div>
        </div>
      </div>
      <div class="study-select-box">
        <div class="title">학습하기</div>
        <ul>
          <li class="completed">
            <div class="img"><img src="../../img/element/schoolStudy/popup/btn_view_test.png" alt=""></div>
            <a href="#">채점결과</a>
          </li>
          <li class="completed">
            <div class="img"><img src="../../img/element/schoolStudy/popup/btn_wrong_test.png" alt=""></div>
            <a href="#">다시풀기</a>
          </li>
          <li class="supplementary now">
            <div class="img"><img src="../../img/element/schoolStudy/popup/btn_supplementary_test.png" alt=""></div>
            <a href="#">문제풀기</a>
          </li>
        </ul>
      </div> -->
      </div>
    </div>
  </div>
  <script>
    //$('#openPopup').modal('show');

    $('#introStudy').modal('hide');
  </script>
</body>

</html>
